0010 REM "ARU - FINANCE CHARGE/CREATE"
0020 REM "Program ARU.HB"
0022 REM "+-----------------------------------------------------------+"
0024 REM "| ADD+ON Software, Inc. Advantage/V Version 6.0.0 - 15May96 |"
0026 REM "|      Copyright (c) 1996 Open Systems Holdings Corp.       |"
0028 REM "|                  All Rights Reserved                      |"
0030 REM "+-----------------------------------------------------------+"
0031 REM "01Nov96 JWK: Not comparing dates correctly (2420)
0040 REM 
0085 SETESC 9000
0090 SETERR 9000
0200 REM " --- IOLists
0220 ARE02A: IOLIST B0$,B[ALL]
0250 ARM02A: IOLIST *,X0$
0280 ARS10N: IOLIST R0$,R[ALL]
0300 ART01A: IOLIST A0$,A[ALL]
0310 ART11A: IOLIST W0$,W1$,W[ALL]
0500 REM " --- Init Data
0520 LET T9$=""
0700 REM " --- Background
0720 CALL "SYC.NB","Examining:",M0+8,COLUMN
0940 REM " --- Disallow 'M'enu option in Error Routine
0950 LET EXIT_CTRL=1
1000 REM " --- Init Read
1020 READ (ART01_DEV1,KEY=N0$,DOM=1030)
1100 REM " --- Main Read
1120 LET K$=KEY(ART01_DEV1,END=4000)
1130 IF K$(1,2)<>N0$ THEN GOTO 4000
1140 READ (ART01_DEV1)IOL=ART01A
1170 IF A0$(27,3)>P9$ THEN GOTO 1100
1180 PRINT @(COLUMN,11),FNF$(A0$(5,P[0]),M0$),"  ",A0$(11,7),
1190 IF A0$(33,1)="F" THEN GOTO 1100
1200 REM " --- Breaks
1220 IF A0$(1,10)<>T0$ THEN GOSUB 6000
2000 REM " --- Determine Inv Amt
2050 READ (ART11_DEV,KEY=A0$(1,17),DOM=2100)
2100 REM " --- Check Detail
2120 LET K$=KEY(ART11_DEV,END=2200)
2140 IF K$(1,17)<>A0$(1,17) THEN GOTO 2200
2150 READ (ART11_DEV)IOL=ART11A
2170 IF W1$(1,1)=" " THEN GOTO 2200
2175 IF W1$(2,3)>P9$ THEN GOTO 2190
2180 LET A[0]=A[0]+W[0]+W[1]
2195 GOTO 2100
2200 REM " --- Minimum Amt
2300 REM " --- Date
2400 REM " --- Age
2420 LET V0$=A0$(27,3),V1$=P9$,V=0
2440 CALL "SYC.CA",V0$,V1$,V
2460 IF V<P9 THEN GOTO 1100
2500 REM " --- Accumulate
2520 LET T0=T0+A[0]
2900 GOTO 1100
4000 REM " --- End
4020 LET T9$="E"
4040 GOSUB 6000
4100 GOTO 9900
6000 REM " --- Customer Break
6010 IF T0$="" THEN GOTO 6300
6015 IF T0<=0 THEN GOTO 6300
6020 IF T0<P8 THEN GOTO 6300
6030 DIM B0$(50),B[1],R0$(3),R[4]
6040 LET B0$(1)=T0$(1,10),B0$(18)=P8$+P7$+P9$,B0$(31,1)="F",B[0]=T0*P7/100,B[1]=0,R[4]=0
6042 IF B[0]<P6 THEN LET B[0]=P6
6045 IF B[0]=0 THEN GOTO 6300
6050 GOSUB 6400
6060 EXTRACT (ARS10_DEV,KEY=N0$+"N",DOM=6070)IOL=ARS10N
6070 LET R[4]=R[4]+1
6080 LET R0$=N0$+"N"
6090 WRITE (ARS10_DEV,KEY=R0$)IOL=ARS10N
6100 REM " --- Check for Duplicate Invoice #'s
6110 LET B0$(11,7)=STR(R[4]:"0000000")
6130 READ (ART01_DEV2,KEY=B0$(1,17)+"00",DOM=6150,ERR=6150); GOTO 6070
6150 READ (ARE03_DEV,KEY=B0$(1,17)+"000",DOM=6170,ERR=6170); GOTO 6070
6170 READ (ARE05_DEV,KEY=B0$(1,2)+B0$(5,6)+"000",DOM=6200,ERR=6200); GOTO 6070
6200 REM " --- Write Invoice
6240 WRITE (ARE02_DEV,KEY=B0$(1,17),DOM=6070)IOL=ARE02A
6300 REM " --- New Customer
6310 IF T9$<>"" THEN RETURN 
6315 LET T0$=A0$(1,10),T0=0
6320 FIND (ARM02_DEV,KEY=N0$+A0$(5,6)+"  ",DOM=6340)IOL=ARM02A
6330 IF X0$(10,1)="Y" THEN GOTO 6390
6340 READ (ART01_DEV1,KEY=A0$(1,10)+"Z",DOM=6350)
6350 LET T0$=""
6390 RETURN 
6400 REM " --- Due Dates
6420 LET V=U[1]
6430 CALL "SYC.CD",U0$(26,1),B0$(22,3),V,V$,STATUS
6440 LET B0$(25,3)=V$,V=U[2]
6450 CALL "SYC.CD",U0$(26,1),B0$(22,3),V,V$,STATUS
6460 LET B0$(28,3)=V$
6490 RETURN 
8000 REM " --- Functions
8010 DEF FNA$(Q$,Q2$)=STR(MOD((ASC(Q$)-32)*POS(" "<>Q2$(2,1)),100):"00")
8020 DEF FNB$(Q1$)=FNA$(Q1$(2),Q1$)+"/"+FNA$(Q1$(3),Q1$)+"/"+FNA$(Q1$(1),Q1$)
8145 REM " --- FNYY21_YY$ Un-Convert 21st Century 2-Char Year to 2-Char Year"
8150 DEF FNYY21_YY$(Q1$)
8155 LET Q3$=" 01234567890123456789",Q1$(1,1)=Q3$(POS(Q1$(1,1)=" 0123456789ABCDEFGHIJ"))
8160 RETURN Q1$
8165 FNEND
8200 REM " --- FNF$ AlphaNumeric Masking Function"
8210 DEF FNF$(Q1$,Q2$)
8220 IF Q2$="" THEN LET Q2$=FILL(LEN(Q1$),"0")
8230 RETURN STR(-NUM(Q1$,ERR=ALPHA_FNF):Q2$,ERR=ALPHA_FNF)
8240 ALPHA_FNF: 
8245 LET Q=1,Q0=0
8250 WHILE LEN(Q2$(Q))
8255 IF POS(Q2$(Q,1)="-()") THEN LET Q0=Q0+1 ELSE LET Q2$(Q,1)="X"
8260 LET Q=Q+1
8265 WEND
8270 IF LEN(Q1$)>LEN(Q2$)-Q0 THEN LET Q1$=Q1$(1,LEN(Q2$)-Q0)
8280 RETURN STR(Q1$:Q2$)
8290 FNEND
9000 REM " --- Standard Error Routine (15May95)"
9010 IF ERR=127 THEN GOTO 9300
9020 CALL "SYC.EA",ERR=9090,EXIT_CTRL,PGM(-2),ERR,TCB(5),E$,E1,E2
9030 IF E1=1 THEN GOTO 9100
9040 IF E1=3 THEN GOTO 9200
9080 PRINT @(0,E2),'CL','CURSOR'("ON"),E$,'LF'
9090 ESCAPE
9100 REM " --- Retry"
9190 RETRY
9200 REM " --- Return"
9290 GOTO 9900
9300 REM " --- Standard Escape Routine"
9310 CALL "SYC.ES",ERR=9350,PGM(-2),TCB(8),E$,E2,V3
9320 IF V3<>127 THEN GOTO 9390
9330 PRINT @(0,E2),'CL','CURSOR'("ON"),E$,'LF'
9350 ESCAPE
9390 RETURN 
9900 RUN "SYS.AA"
9999 END
