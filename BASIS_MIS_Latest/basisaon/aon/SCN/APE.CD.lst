0010 REM "APE - MANUAL CHECK ENTRY 4"
0020 REM "Program APE.CD"
0022 REM "+-----------------------------------------------------------+"
0024 REM "| ADD+ON Software, Inc. Advantage/V Version 6.0.2 - 01Jan96 |"
0026 REM "|      Copyright (c) 1996 Open Systems Holdings Corp.       |"
0028 REM "|                  All Rights Reserved                      |"
0030 REM "+-----------------------------------------------------------+"
0031 REM "09Sep96 WGH: Error 47 Line 6070 (6070)"
0032 REM "16Sep96 WGH: Error 47 Line 2560 (2520)"
0033 REM "02Oct96 WGH: APM-03 Temporary Vendor record can get written with wrong vendor name (1396-1397,5610)"
0034 REM "29May99 WGH: Only write APM-03 records for temporary vendors (4110)"
0040 REM 
0045 SETESC 9000
0050 SETERR 9000
0060 ON O0 GOTO 0070,1000
0100 REM " --- OPEN/LOCK FILES"
0105 IF Y0$(12,4)="TEMP" THEN PRINT @(10,19),'CL',
0200 REM " --- IOLISTS"
0210 APE02A: IOLIST W0$,W1$,W0,W1,W2
0220 APE22A: IOLIST Y0$(1),Y[0],Y[1],Y[2]
0240 APM03A: IOLIST D0$(1),D1$(1)
0250 APT01A: IOLIST E0$,E[0],E[1],E[2]
0260 APM10A: IOLIST X0$(1)
0350 APT11A: IOLIST X0$,X1$,X[0],X[1],X[2]
0500 REM " --- INIT DATA"
0520 LET Y0$(1)=A0$(1,17)
0900 REM " --- INIT FILE"
0920 READ (APE02_DEV,KEY=A$,DOM=0930)
0940 LET O0=1
1000 REM " --- INVOICE"
1005 CALL "SYC.WC",1,0,80,0,0,13,0
1010 PRINT @(0,11),'CL',@(11,12),J1$(1,10),@(40,12),'CL',
1015 IF Y0$(12,4)="TEMP" THEN PRINT @(0,19),'CL',
1020 LET V2$="",V2$=KEY(APE22_DEV,END=1060)
1030 IF LEN(V2$)<29 OR V2$(1,11)<>A$ THEN LET V2$=""
1040 IF V2$<>"" THEN IF V2$(28,2)<>"00" THEN READ (APE22_DEV,KEY=V2$(1,27)+"Z",DOM=1020)
1050 IF V2$<>"" THEN LET V2$=V2$(18,10)
1060 LET V0$="S",V1$="KE",V0=10,V1=0,V2=11,I0=0,X3=0
1070 GOSUB 7000
1080 IF V3=4 THEN GOTO 4500
1100 IF V$="" THEN GOTO 0900
1110 LET Y0$(18,10)=V$,Y0$(28,2)="00",Y$=Y0$(1,29),O9=0
1120 IF P3$(1,1)<>"Y" THEN LET Y$(3,2)=""
1130 DIM Y[2],U[2]
1140 LET Y0$(30)="",Y0$(30,3)=A0$(28,3)
1145 IF Y$(12,4)<>"TEMP" THEN LET Y0$(33,2)=C1$(1,2)
1150 FIND (APE22_DEV,KEY=Y$,DOM=1200)IOL=APE22A
1160 GOSUB 5000
1170 LET U[0]=Y[0],U[1]=Y[1],U[2]=Y[2]
1180 LET O9=1
1300 REM " --- OPEN INVOICE"
1320 LET E0$=Y0$(1,4)+Y0$(12,16)+"00",O1=0
1330 DIM E[2],X[2]
1340 FIND (APT01_DEV,KEY=E0$,DOM=1400)IOL=APT01A
1350 GOSUB 6000
1360 LET O1=1
1370 ON O9 GOTO 1380,4000
1380 LET Y0$(30,3)=E0$(29,3),Y[0]=E[0],Y[1]=E[1],Y[2]=E[2],Y0$(33,2)=E0$(23,2)
1385 LET O9=2
1390 GOSUB 5000
1392 IF Y0$(12,4)<>"TEMP" THEN GOTO 1400
1395 IF Y0$(12,4)="TEMP" THEN GOSUB 5400
1397 IF POS(A1$=D1$)<>1 THEN LET D1$(1)=A1$; GOTO 1000
1400 REM " --- NEW INVOICE"
1410 ON O9 GOTO 1420,4000
1420 CALL "SYC.YN",1,"Is This The Correct Invoice",2,V$,V3
1440 ON POS(V$="YN") GOTO 1400,1450,1000
1500 REM " --- SETUP"
1510 LET Y0$(30,3)=A0$(28,3)
2000 REM " --- DATE"
2010 LET I0=0,V3=0
2020 IF O1=1 THEN GOTO 3900
2030 LET V0$="D",V1$="R",V2$=Y0$(30,3),V0=8,V1=11,V2=11
2040 GOSUB 7000
2050 IF P3$(18,1)="N" THEN IF V$<R9$ THEN GOTO 2054
2052 GOTO 2060
2054 PRINT 'RB',
2056 LET V0$="S",V1$="C",V2$="",V3$="",V4$="This Date Is In A Closed G/L Period <Enter>: ",V0=1,V1=FNV(V4$),V2=22
2058 GOSUB 7000
2059 GOTO 2000
2060 LET Y0$(30,3)=V$
2090 GOTO 3900
2100 REM " --- AMT"
2120 LET V0$="N",V2$=STR(Y[0]),V3$=M1$,V1=23,V2=11
2140 GOSUB 7000
2150 IF O1=1 THEN IF ABS(V)>ABS(E[0]) THEN GOTO 2100
2160 LET Y[0]=V
2190 GOTO 3900
2200 REM " --- DISCOUNT"
2220 LET V0$="N",V2$=STR(Y[1]),V3$=M1$,V1=23+M1,V2=11
2240 GOSUB 7000
2260 LET Y[1]=V
2270 IF ABS(Y[1])>ABS(Y[0]) THEN GOTO 2200
2290 GOTO 3900
2300 REM " --- RETENTION"
2302 GOTO 3900
2310 IF P3$(3,1)<>"Y" THEN GOTO 3900
2320 IF O1<>1 THEN GOTO 3900
2330 IF P3$(3,1)<>"Y" THEN GOTO 3900
2340 GOSUB 7000
2350 IF O1=1 THEN IF ABS(V)>E[2] THEN GOTO 2300
2360 LET Y[2]=V
2390 GOTO 3900
2400 REM " --- PAYMENT"
2420 GOSUB 5000
2490 GOTO 3900
2500 REM " --- DIST CODE"
2510 IF O1=1 THEN GOTO 3900
2520 IF P3$(2,1)<>"Y" THEN GOTO 2555
2530 LET V0$="S",V1$="CR",V2$=Y0$(33,2),V0=2,V1=20,V2=11
2535 LET V4$="Enter A Valid Distribution Code, <F3>=Lookup"
2540 GOSUB 7000
2542 IF V3<>3 THEN GOTO 2550
2544 LET V4=1,V5=APM10_DEV,V6=4,V7=2,V8=6,V9=20,V5$="B"
2546 CALL "SYC.LZ",V1,V2,V4,V5,V6,V7,V8,V9,V$,V5$,N0$
2548 IF V$="" THEN GOTO 2530
2550 LET Y0$(33,2)=V$
2555 DIM X0$(27)
2560 FIND (APM10_DEV,KEY=N0$+"B"+Y0$(33,2),DOM=2580)IOL=APM10A
2570 PRINT @(10,19),'SB',"Distribution Code: ",'SF',X0$(6,20),'CL',
2572 LET X9$=X0$(6,20)
2575 GOTO 3900
2580 IF P3$(2,1)="Y" THEN GOTO 2500
2582 PRINT 'RB',
2584 LET V0$="S",V1$="C",V2$="",V3$="",V4$="*** Missing Distribution Code <Enter>: ",V0=1,V1=FNV(V4$),V2=22
2586 GOSUB 7000
2590 GOTO 9900
3900 REM " --- NEXT FIELD"
3910 IF V3=4 THEN GOTO 4000
3920 IF V3<>2 THEN GOTO 3950
3930 IF I0>0 THEN LET I0=I0-1
3940 GOTO 3960
3950 LET I0=I0+1
3955 IF ABS(I0)>1000 THEN GOTO 4000
3960 ON I0 GOTO 2000,2500,2100,2200,2300,2400,4000
4000 REM " --- CORRECT"
4005 PRINT @(0,21),'CL',
4010 LET V0$="S",V1$="KC",V2$="",V3$="",V4$="Is The Ribbon Information Correct (Y/N/##/Delete)? ",V0=6,V1=FNV(V4$),V2=22
4020 GOSUB 7000
4022 LET I=INT(NUM(V$,ERR=4030))
4024 IF I>0 THEN LET I0=I-2; GOTO 4700
4030 IF V$="DELETE" THEN GOTO 4300
4040 ON POS(V$="YN") GOTO 4000,4100,4700
4100 WRITE (APE22_DEV,KEY=Y$)IOL=APE22A
4102 DIM D0$(14)
4105 LET D0$(1)=Y$(1,4)+Y$(18,10)
4110 IF Y0$(12,6)="TEMP  " THEN WRITE (APM03_DEV,KEY=D0$)IOL=APM03A
4120 FOR X=0 TO 2
4130 LET T[X]=T[X]+Y[X]-U[X]
4140 NEXT X
4150 GOSUB 5200
4200 IF O1=0 THEN RUN "APE.CE"
4220 GOTO 1000
4300 REM " --- DELETE"
4310 PRINT @(0,L0),'CE',
4315 REM " -- Remove Invoice Records
4320 REMOVE (APE22_DEV,KEY=Y$,DOM=4325)
4325 LET K$=KEY(APE22_DEV,END=4350)
4330 IF LEN(K$)<27 THEN GOTO 4350
4335 IF K$(1,27)<>Y$(1,27) THEN GOTO 4350
4340 REMOVE (APE22_DEV,KEY=K$)
4345 GOTO 4325
4350 REM " -- Remove Distribution Records
4355 READ (APE12_DEV,KEY=Y$(1,27),DOM=4360)
4360 LET K$=KEY(APE12_DEV,END=4390)
4365 IF K$(1,27)<>Y$(1,27) THEN GOTO 4390
4370 REMOVE (APE12_DEV,KEY=K$)
4375 GOTO 4360
4390 LET T[0]=T[0]-U[0],T[1]=T[1]-U[1],T[2]=T[2]-U[2]
4420 GOSUB 5200
4490 GOTO 1000
4500 REM " --- END"
4520 RUN "APE.CB"
4700 REM " --- CORRECT
4710 IF I>1 AND P3$(2,1)<>"Y" THEN LET I0=I0+1
4730 IF V$="N" THEN GOTO 2000 ELSE GOTO 3900
5000 REM " --- DISPLAY"
5020 PRINT @(0,11),Y0$(18,10),@(11),FNB$(Y0$(30,3)),@(23),Y[0]:M1$,Y[1]:M1$,Y[0]-Y[2]-Y[1]:M1$,
5030 IF P3$(3,1)="Y" THEN PRINT @(23+3*M1),Y[2]:M1$,
5040 IF P3$(2,1)="Y" THEN PRINT @(20,11),Y0$(33,2),
5050 PRINT 'SB',@(50,13),"Distribute:  ",'SF',Y[0]:M1$,
5090 RETURN 
5200 REM " --- DISPLAY TOTAL"
5220 PRINT @(23,8),T[0]:M1$,T[1]:M1$,T[0]-T[2]-T[1]:M1$,
5240 IF P3$(3,1)="Y" THEN PRINT @(23+3*M1,8),T[2]:M1$,
5290 RETURN 
5400 REM " --- TEMP VENDOR"
5405 DIM D1$(105),R1$(105)
5410 LET A1$=A1$+J1$(1,30-LEN(A1$)),R1$(1)=A1$
5415 IF E0$(5,4)="TEMP" THEN READ (APM03_DEV,KEY=E0$(1,4)+E0$(11,10),DOM=5418)*,R1$(1)
5418 LET D1$(1)=R1$
5420 FIND (APM03_DEV,KEY=Y0$(1,4)+Y0$(18,10),DOM=5450)IOL=APM03A
5450 PRINT @(10,19),D1$(1,30),
5460 IF D1$(1,LEN(A1$))=A1$ AND R1$(1,LEN(A1$))=A1$ THEN RETURN 
5465 PRINT 'RB',
5467 PRINT @(15,21),"The Names On The Check And Invoice Do Not Match",
5470 LET V0$="S",V1$="C",V2$="",V3$="",V4$="<Enter>=Re-Enter Invoice #, <F1>=Accept Name On The Invoice: ",V0=1,V1=FNV(V4$),V2=22
5480 GOSUB 7000
5485 PRINT @(0,19),'CL',@(0,21),'CL',
5487 IF V3=1 THEN GOSUB 5600
5490 RETURN 
5600 REM " --- DISPLAY TEMP VENDOR"
5610 LET A1$=D1$(1,30)
5615 PRINT 'SB',@(6,15),"Address:",'SF',
5620 PRINT @(25,5),D1$(1,30),@(15,15),D1$(31,24),@(15,16),D1$(55,24),@(15,17),D1$(79,24),
5650 EXTRACT (APE02_DEV,KEY=Y0$(1,11),DOM=5960)IOL=APE02A
5660 LET W1$=D1$(1,30)
5670 WRITE (APE02_DEV,KEY=Y0$(1,11))IOL=APE02A
5690 RETURN 
6000 REM " --- TOTAL OPEN INVOICE"
6050 READ (APT11_DEV,KEY=E0$(1,20),DOM=6051)
6060 LET K$=KEY(APT11_DEV,END=6190)
6070 IF K$(1,20)<>E0$(1,20) THEN GOTO 6190
6080 READ (APT11_DEV)IOL=APT11A
6100 IF X1$(1,1)=" " THEN GOTO 6190
6110 FOR CNT=0 TO 2
6115 LET E[CNT]=E[CNT]+X[CNT]
6120 NEXT CNT
6130 GOTO 6060
6190 RETURN 
6500 REM " --- REPAINT DISTRIBUTION HEADING
6520 PRINT @(0,14),'CL','SB',
6530 PRINT @(0,14),"Seq",@(5),"Account",@(47+M1),"Amount",
6540 IF G4$(3,1)="Y" THEN PRINT @(64+G7),"Units",
6550 IF P3$(16,1)="Y" THEN PRINT @(20),"Miscellaneous",
6580 PRINT @(10,19),'SB',"Distribution Code: ",'SF',X9$
6590 RETURN 
7000 REM " --- Standard Input Routine (15May95)"
7010 CALL "SYC.IA",V0$,V1$,V2$,V3$,V4$,PGM(-2),V0,V1,V2,V$,V,V3,DISPLAY_LEN
7020 IF V3=999 THEN GOTO 7200
7030 IF V3=127 THEN GOTO 7100
7090 RETURN 
7100 REM " --- Escape During Input"
7110 CALL "SYC.ES",ERR=7200,PGM(-2),TCB(8),E$,E2,V3
7120 IF V3<>127 THEN GOTO 7000
7130 PRINT @(0,E2),'CL','CURSOR'("ON"),E$,'LF'
7200 REM " --- Error During Input"
7210 ESCAPE
7290 GOTO 7000
8000 REM " --- FUNCTIONS"
8010 DEF FNA$(Q$,Q2$)=STR(MOD((ASC(Q$)-32)*POS(" "<>Q2$(2,1)),100):"00")
8020 DEF FNB$(Q1$)=FNA$(Q1$(2),Q1$)+"/"+FNA$(Q1$(3),Q1$)+"/"+FNA$(Q1$(1),Q1$)
8090 DEF FNV(Q$)=42+INT(LEN(Q$)/2)
9000 REM " --- Standard Error Routine (15May95)"
9010 IF ERR=127 THEN GOTO 9300
9020 CALL "SYC.EA",ERR=9090,EXIT_CTRL,PGM(-2),ERR,TCB(5),E$,E1,E2
9030 IF E1=1 THEN GOTO 9100
9040 IF E1=3 THEN GOTO 9200
9080 PRINT @(0,E2),'CL','CURSOR'("ON"),E$,'LF'
9090 ESCAPE
9100 REM " --- Retry"
9190 RETRY
9200 REM " --- Return"
9290 GOTO 9900
9300 REM " --- Standard Escape Routine"
9310 CALL "SYC.ES",ERR=9350,PGM(-2),TCB(8),E$,E2,V3
9320 IF V3<>127 THEN GOTO 9390
9330 PRINT @(0,E2),'CL','CURSOR'("ON"),E$,'LF'
9350 ESCAPE
9390 RETURN 
9900 RUN "SYS.AA"
9999 END
