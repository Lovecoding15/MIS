0010 REM "TMR - Literature Mailing Labels
0020 REM "Program: TMR.AA"
0030 REM "ADD+ON SOFTWARE VERSION 5
0035 REM "12/09/91 by Jerry Koch
0040 REM "COPYRIGHT(C)1991 MicroAccounting Systems, Inc. ALL RIGHTS RESERVED
0041 REM 
0042 REM "01/06/97 KJS WA: #221 ADS, this program had MAJOR param problems
0079 REM 
0080 BEGIN 
0090 SETERR 9000
0100 REM "OPEN/LOCK FILES"
0110 OPEN (1)"TMM-01"
0160 OPEN (6)"SYS-01"
0200 REM "IOLISTS"
0260 IOLIST P0$,P1$,P2$,P3$,P4$
0400 REM " --- Parameters"
0401 GOSUB 62000; REM "WA: #221
0420 LET N0$=PRM$[FID,TFIRM],N1$=PRM$[FID,TFNAME],N2$="TM",N4$=PRM$[FID,TPNAME]; REM "WA: #221
0430 FIND (6,KEY=N0$+N2$+"00",DOM=9800)IOL=0260
0440 LET M0$="000000",R9$=PRM$[AR,INSTALL]; REM "WA: #221, I2$="06009"
0490 LET M1$="###,###.00-",M1=LEN(M1$)
0500 REM "INIT DATA"
0510 LET H0=65,H1=120,H=0,H1$=N1$,H2$=N3$,L9=50,L=L9+1
0520 DIM J$(80,"-"),J0$(20,"0"),J1$(20," ")
0530 LET W0=NUM(PRM$[AR,THREE](5,2)),W1=NUM(PRM$[AR,THREE](9,2)),W2=NUM(PRM$[AR,THREE](7,2)),W3=1; REM "WA: #221
0540 DIM W0$(W0*W1*6),W9$(W2,$0A$)
0550 DIM P[2]; LET P[0]=NUM(PRM$[AR,KEYLEN]),P[1]=NUM(PRM$[AR,KEYMAX]),P[2]=NUM(PRM$[AR,THREE](4,1)); REM "WA: #221
0555 LET M7$="00000"
0560 IF P[2]=9 THEN LET M7$=M7$+"-0000" ELSE LET P[2]=5
0570 DIM SORT$[4]
0580 LET SORTS$="0=Name, 1=Firm, 2="+CVS(P2$(1,20),2)+", 3="+CVS(P2$(21,20),2)+", 4="+CVS(P2$(41,20),2),SORT$[0]="Name",SORT$[1]="Firm",SORT$[2]=CVS(P2$(1,20),2),SORT$[3]=CVS(P2$(21,20),2),SORT$[4]=CVS(P2$(41,20),2)
0610 CLOSE (6)
0620 OPEN (6)"TMM-10"
0700 REM "BACKGROUND"
0720 PRINT 'SB',@(24,3),"Label Sequence:",@(0,4),J$,@(21,5),"Labels Per Record:",@(0,6),J$,@(23,7),"Literature Code:",@(0,8),J$,@(19,9),"Flagged Only? <Y/N>:",@(0,10),J$,@(19,11),"Enter Starting Info: ",@(0,12),J$,@(21,13),"Enter Ending Info:",@(0,14),J$,@(0,16),J$,'SF',
0900 REM "--- Init
0910 LET SRT$="0",W3=1,P7$="",P9$="Y"
0990 PRINT 'CF',
1000 REM "--- Sequence
1010 IF LEN(SORTS$)<80 THEN PRINT @(40-INT(LEN(SORTS$)/2),23),SORTS$, ELSE PRINT @(0,23),SORTS$(1,79),
1020 LET V0$="S",V1$="CRE",V2$=SRT$,V3$="01234",V4$="Enter Label Print Sequence",V0=1,V1=40,V2=3
1040 GOSUB 7000
1045 IF V3=4 OR V$="END" THEN GOTO 9900
1060 LET SRT$=V$
1070 PRINT @(0,23),'CL',@(V1+V0+1,V2),SORT$[NUM(SRT$,ERR=1000)],'CL',
1080 IF SRT$="0" THEN LET R0=20 ELSE IF SRT$="1" THEN LET R0=15 ELSE LET R0=11
1090 GOTO 3900
1200 REM "--- Labels per Record
1220 LET V0$="Z",V1$="CR",V2$=STR(W3),V3$="",V4$="Print How Many Labels Each?",V0=3,V1=40,V2=5
1240 GOSUB 7000
1260 IF V<1 THEN GOTO 1200
1280 LET W3=V
1290 GOTO 3900
1300 REM "--- Lit Code
1310 LET V0$="S",V1$="C",V2$=P7$,V3$="",V4$="Enter A Valid Literature Code, <F1>=All, <F3>=Look-Up",V0=2,V1=40,V2=7,V5$="D"
1320 GOSUB 7000
1330 IF V3<>3 THEN GOTO 1350
1334 LET V4=1,V5=6,V6=4,V7=2,V8=6,V9=20
1336 CALL "SYC.LK",V1,V2,V4,V5,V6,V7,V8,V9,V$,V5$,N0$
1340 IF V$="" THEN GOTO 1300
1350 IF V3=1 OR V$="" THEN LET P7$=""; PRINT @(V1,V2),"All",'CL',; GOTO 1390
1355 LET V$=V$+"  ",V$=V$(1,2)
1360 FIND (6,KEY=N0$+V5$+V$,DOM=1300)X0$
1365 PRINT @(V1,V2),V$," ",X0$(6,20),
1380 LET P7$=V$
1390 GOTO 3900
1400 REM "--- Lit Flagged?
1420 LET V0$="Y",V1$="CR",V2$=P9$,V4$="Print Only Contacts Flagged For Literature?",V0=1,V1=40,V2=9
1440 GOSUB 7000
1450 LET P9$=V$
1460 IF P9$="N" THEN LET P6$="",P8$=""
1490 GOTO 3900
1600 REM "--- Starting Info
1610 IF P9$="Y" THEN GOTO 3900
1620 LET V0$=R0$,V1$="",V2$=P6$,V3$="",V4$="Enter Starting Info, <F1>=First",V0=R0,V1=40,V2=11
1640 GOSUB 7000
1650 IF V3=1 THEN LET V$=""
1660 LET P6$=V$
1680 IF P6$="" THEN PRINT @(V1,V2),"First",'CL',
1690 GOTO 3900
1700 REM "--- Ending Info
1710 IF P9$="Y" THEN GOTO 3900
1720 LET V0$=R0$,V1$="",V2$=P8$,V3$=R3$,V0=R0,V1=40,V2=13
1740 GOSUB 7000
1750 IF V3=1 THEN LET V$=""
1760 LET P8$=V$
1780 IF P8$="" THEN PRINT @(V1,V2),"Last",'CL',
1785 IF P8$<>"" THEN IF P8$<P6$ THEN GOTO 1700
1790 GOTO 3900
3900 REM "NEXT FIELD"
3910 IF V3<>2 THEN GOTO 3940
3920 IF I0>0 THEN LET I0=I0-1
3930 GOTO 3950
3940 LET I0=I0+1
3960 ON I0 GOTO 1000,1200,1300,1400,1600,1700,3990
3990 LET I0=K0
4000 REM "CORRECT?"
4010 LET V0$="Y",V1$="CE",V2$="",V3$="",V4$="Is The Above Information Correct? <Y/N/End>: ",V0=1,V1=63,V2=22
4020 GOSUB 7000
4030 IF V3=4 OR V$="END" THEN GOTO 9900
4040 IF V$="N" THEN GOTO 1000
4060 IF V$<>"Y" THEN GOTO 4000
4100 REM "--- Run Overlay
4190 RUN "TMR.AB"
7000 REM " --- Standard Input Routine (15May95)"
7010 CALL "SYC.IA",V0$,V1$,V2$,V3$,V4$,PGM(-2),V0,V1,V2,V$,V,V3,DISPLAY_LEN
7020 IF V3=999 THEN GOTO 7200
7030 IF V3=127 THEN GOTO 7100
7090 RETURN 
7100 REM " --- Escape During Input"
7110 CALL "SYC.ES",ERR=7200,PGM(-2),TCB(8),E$,E2,V3
7120 IF V3<>127 THEN GOTO 7000
7130 PRINT @(0,E2),'CL','CURSOR'("ON"),E$,'LF'
7200 REM " --- Error During Input"
7210 ESCAPE
7290 GOTO 7000
8000 REM "FUNCTIONS"
8010 DEF FNA$(Q$,Q2$)=STR((ASC(Q$)-32)*POS(" "<>Q2$(2,1)):"00")
8020 DEF FNB$(Q1$)=FNA$(Q1$(2),Q1$)+"/"+FNA$(Q1$(3),Q1$)+"/"+FNA$(Q1$(1),Q1$)
8030 DEF FNC$(Q1$)=FNA$(Q1$(2),Q1$)+FNA$(Q1$(3),Q1$)+FNA$(Q1$(1),Q1$)
8040 DEF FND$(Q$)=CHR(NUM(Q$(5,2))+32)+CHR(NUM(Q$(1,2))+32)+CHR(NUM(Q$(3,2))+32)
8050 DEF FNE$(Q$)=STR(INT(TIM):"00")+":"+STR(FPT(TIM)*60:"00")
8060 DEF FNF$(Q$,Q1$)=STR(-NUM(Q$):Q1$)
8070 DEF FNG$(Q$)=STR((ASC(Q$)-32)*POS(" "<>Q$):"000")
9000 REM " --- Standard Error Routine (15May95)"
9010 IF ERR=127 THEN GOTO 9300
9020 CALL "SYC.EA",ERR=9090,EXIT_CTRL,PGM(-2),ERR,TCB(5),E$,E1,E2
9030 IF E1=1 THEN GOTO 9100
9040 IF E1=3 THEN GOTO 9200
9080 PRINT @(0,E2),'CL','CURSOR'("ON"),E$,'LF'
9090 ESCAPE
9100 REM " --- Retry"
9190 RETRY
9200 REM " --- Return"
9210 SETERR 9000
9290 GOTO 9900
9300 REM " --- Standard Escape Routine"
9310 CALL "SYC.ES",ERR=9350,PGM(-2),TCB(8),E$,E2,V3
9320 IF V3<>127 THEN GOTO 9390
9330 PRINT @(0,E2),'CL','CURSOR'("ON"),E$,'LF'
9350 ESCAPE
9390 RETURN 
9800 REM " --- Display Parameter record error"
9810 LET LINE_ERR$=LST(PGM(TCB(5)))
9820 CALL "SYC.YA",LINE_ERR$,N2$,ERR
9900 RUN "SYS.AA"
9999 END
62000 REM " --- Set-up ADD+ON Environment"
62010 DIM PRM$[0]; CALL "ADC.01",PRM$[ALL],STATUS
62020 IF STATUS<>0 THEN EXITTO 9900
62030 LET FID=0,AP=1,AR=2,BM=3,DC=4,FA=5,GL=6,IV=7,MP=8,OP=9,PO=10,PR=11,SA=12,SH=13,SY=14,WO=15,TS=21,TB=22,DC=23,V2=24,EF=25; REM " ---- Module Id Numbers"
62040 DIM J$(80,"-"),J0$(40,"0"),J1$(80)
62050 LET INSTALL=0,KEYLEN=1,KEYMAX=2,KEYMASK=3,CPERIOD=4,CYEAR=5,DMASK=6,UMASK=7,RMASK=8,TWO=9,THREE=10,FOUR=11,EMASK=12,TOPCODE=1,TDATE=2,TMENU=3,TPRINTER=4,TSECURE=5,TFIRM=6,TPMODE=7,TPROG=8,TPOPTS=9,TFNAME=10,TPNAME=11,TLDATE=12
62090 RETURN 
