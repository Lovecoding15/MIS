0010 REM "ADC - Select ADD+ON PF File"
0020 REM "Program: ADC.11"
0030 REM "+----------------------------------------------------------+"
0031 REM "|            ADminstrator System Version 1.0.2a            |
0032 REM "|     Copyright (C) 1994 MicroAccounting Systems, Inc.     |
0033 REM "|                 All Rights Reserved"                     |
0034 REM "+----------------------------------------------------------+
0049 REM "MAS:PHC 05/13/96 - #6270,6275 Correct handling of multiple pages of PF files"
0060 SETERR 9000; SETESC 9900
0080 ENTER FSELECTION$,FDESC$
0110 LET SYS01_DEV=UNT; OPEN (SYS01_DEV,ERR=9900)"SYS-01"
0120 LET SYM02_DEV=UNT; OPEN (SYM02_DEV,ERR=9900)"SYM-02"
0210 IOLIST A0$,A1$
0220 IOLIST X$,F0$,F1$,F2$,F3$,F4$,F5$
0230 IOLIST P0$,P1$,P2$,P3$(1),P[0],P[1],P[2],P[3],P[4]
0410 DIM P[4]
0440 FIND (SYS01_DEV,KEY="T"+FID(0),DOM=9900)IOL=0220
0445 DIM P3$(64)
0450 FIND (SYM02_DEV,KEY="A"+F0$(4,3),DOM=9900)IOL=0230
0460 IF P[0]<1 THEN LET P[0]=10
0510 IF FNP$(P3$(61,3))="" THEN LET PFNAME$="PF"+FNP$(F0$(4,3)) ELSE LET PFNAME$="PF"+FNP$(P3$(61,3)) FI; LET PAGES=11,D_STATUS=0,MAXOPT=P[0]
0520 DIM MORE$[PAGES,MAXOPT,3],J1$(40)
0530 LET PFILE_DEV=UNT; OPEN (PFILE_DEV,ERR=9900)PFNAME$+"A"
0540 LET X0=0,X1=1,PAGE=1,FWIDTH=65,FHEIGHT=15,FXPOS=8,FYPOS=7,MODE=1; DIM FLIST$[PAGES,FHEIGHT-2,5]; LET FTITLE$="Print-to-File Report Selection",FSELECTION$="",FMAX_ROW=FHEIGHT-5
0720 DIM FHEADING$(FWIDTH-2); LET FHEADING$(1)="     Report Title                       Date  Time  Size"; DIM FFOOTER$(FWIDTH-2); LET FFOOTER$(1)="                  <F4>=End"
0730 CALL "ADC.WA",0,FWIDTH,FHEIGHT,FXPOS,FYPOS,FTITLE$,FWNAME$
1000 REM "BUILD PRINT TO FILE SELECT WINDOW"
1040 LET X$=FID(PFILE_DEV,ERR=1380),INDEX=1
1080 READ (PFILE_DEV,IND=INDEX,END=1280)X0$,X1$
1100 IF FNP$(X0$)="" THEN LET INDEX=INDEX+1; GOTO 1220
1120 LET SERIAL_FILE=UNT; OPEN (SERIAL_FILE,ERR=1220)PFNAME$+STR(INDEX); LET X$=FIN(SERIAL_FILE),X$=X$(1,4),BYTES=DEC(X$); CLOSE (SERIAL_FILE)
1130 IF X0>FMAX_ROW-2 THEN GOSUB 6200; IF FSELECTION$="END" OR FKEY=4 THEN GOTO 4000
1135 IF FSELECTION$<>"" THEN GOTO 4000
1140 DIM G1$(FWIDTH-2); LET G1$(2)=X0$(1,36)+" "+X1$(1,8)+" "+X1$(9,2)+":"+STR(INT(NUM(X1$(12,2))*60/100):"00  ")+STR(BYTES:"####,##0")
1160 LET FLIST$[PAGE,X1,1]=G1$,FLIST$[PAGE,X1,3]=STR(INDEX),FLIST$[PAGE,X1,2]=STR(X1),FLIST$[PAGE,X1,4]=FNP$(X0$(1,36))
1180 LET X0=X0+1,X1=X1+1,L=L+1,INDEX=INDEX+1
1200 LET DATE$=X1$(7,2)+X1$(1,2)+X1$(4,2)+X1$(9,2)+STR(INT(NUM(X1$(12,2))*60/100):"00"); IF HI_DATE$="" OR HI_DATE$<DATE$ THEN LET HI_DATE$=DATE$; LET SELECTION$=STR(INDEX)
1260 GOTO 1080
1280 IF X0=0 THEN PRINT @(0,INT(HEIGHT/2)),"No Reports Found. <",'BB',"Return",'EB',">",; LET V0$="SA",V1$="EK",V2$="",V3$="",V4$="",V0=1,V1=28,V2=INT(HEIGHT/2); GOSUB 7000; CALL "ADC.WD",ERR=4000,FWNAME$; GOTO 4000
1320 LET FSELECTION$=FSELECTION$+"|EOF"
1340 GOSUB 6200
4090 GOTO 9900
6200 REM "---- Call To Lightbar Select"
6205 LET MODE=1
6210 PRINT @(0,0),'SB','BR',FHEADING$,'ER',@(0,FHEIGHT-3),'BR',FFOOTER$,'SF','ER',
6230 PRINT 'CURSOR'("OFF"),; CALL "ADC.SA",MODE,FLIST$[ALL],MORE$[ALL],FSELECTION$,PAGE,FMAX_ROW,FWNAME$,FHEIGHT,FWIDTH,FKEY; PRINT 'CURSOR'("ON"),
6240 IF FSELECTION$="END" THEN LET FSELECTION$=""; GOTO 6390
6250 IF FKEY=-16 THEN LET PAGE=PAGE+1,X0=0,X1=1; GOTO 6390
6270 LET FSELECT$=FLIST$[PAGE,NUM(FSELECTION$,ERR=6300),3],FDESC$=FLIST$[PAGE,NUM(FSELECTION$,ERR=6300),4]; REM [00049]
6275 LET FSELECTION$=FSELECT$; REM [00049]
6280 GOTO 6390
6300 LET FDESC$="",FSELECTION$=""
6390 RETURN 
7000 REM " --- User Input Routine"
7020 CALL "ADC.IA",V0$,V1$,V2$,V3$,V4$,PGM(-1),V0,V1,V2,V$,V,V3,DISPLAY_LEN
7040 IF V3=5 THEN GOTO 7100
7050 IF V3=6 THEN GOTO 7200
7085 LET I$=V$
7090 RETURN 
7100 REM " --- Error During Input"
7200 REM " --- Escape Requested"
7210 PRINT @(0,22),'CL','CURSOR'("ON"),
7220 ESCAPE
7290 GOTO 7000
7300 REM "---- Special User Input"
7320 CALL "ADC.IB",V0$,V1$,V2$,V3$,V4$,PGM(-1),V0,V1,V2,V$,V,V3,DISPLAY_LEN
7330 IF V3<5 OR V3>6 THEN GOTO 7350
7340 ESCAPE
7390 RETURN 
8000 REM "FUNCTIONS"
8010 DEF FNA$(Q$,Q2$)=STR((ASC(Q$)-32)*POS(" "<>Q2$(2,1)):"00")
8020 DEF FNB$(Q1$)=FNA$(Q1$(2),Q1$)+"/"+FNA$(Q1$(3),Q1$)+"/"+FNA$(Q1$(1),Q1$)
8030 DEF FNC$(Q1$)=FNA$(Q1$(2),Q1$)+FNA$(Q1$(3),Q1$)+FNA$(Q1$(1),Q1$)
8040 DEF FND$(Q$)=CHR(NUM(Q$(5,2))+32)+CHR(NUM(Q$(1,2))+32)+CHR(NUM(Q$(3,2))+32)
8050 DEF FNE$(Q$)=STR(INT(TIM):"00")+":"+STR(FPT(TIM)*60:"00")
8060 DEF FNF$(Q$,Q1$)=STR(-NUM(Q$):Q1$)
8070 DEF FNG$(Q$)=STR((ASC(Q$)-32)*POS(" "<>Q$):"000")
8090 DEF FNP$(Q$)=CVS(Q$,2)
8180 DEF FNU$(Q$)=CVS(Q$,4)
9000 REM "---- Errors"
9010 LET ER0$=LST(PGM(TCB(5))),ER1$=STR(TCB(5)),ER2$=PGM(-1),ER0=ERR,ER1=0
9020 IF ER0=0 AND POS(" (PTR"=ER0$)>0 THEN GOTO 9200
9040 CALL "ADC.EA",ERR=9080,ER0$,ER1$,ER2$,ER0,ER1
9050 IF ER1=1 THEN GOTO 9100
9060 IF ER1=3 THEN GOTO 9800
9080 PRINT @(0,22),'CL',ER0$,'LF','LF',; ESCAPE
9100 REM "---- Retry"
9110 RETRY
9120 RETRY
9200 REM "---- Printer Offline"
9210 SETERR 9000
9220 CALL "ADS.EB",V3
9230 IF V3=4 THEN GOTO 9900
9240 IF V3=6 THEN ESCAPE
9290 RETRY
9800 REM "---- Error Exit"
9820 IF ER0$="" THEN LET STATUS=ERR ELSE LET STATUS=ER0
9900 REM "---- Exit"
9910 CALL "ADC.WD",ERR=9911,FWNAME$
9920 CLOSE (SERIAL_FILE,ERR=9921)
9930 CLOSE (PFILE_DEV,ERR=9931)
9990 EXIT 
9999 END
