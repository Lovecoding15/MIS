0010 REM <BAL.01>
0020 REM Generate a Flex license if hostid is known (in sn_license.dat).
0030 REM Email or fax license by emailing autoresponder if there is a
0040 REM fax# or email address.
0050 REM IF INFO(3,2)="thines" THEN ESCAPE
0060 SETERR 9000
0070 SETESC 9000
0080 DIM SN_LICENSE$:"SERIAL_NUM:C(12),DATE:C(8),TIME:C(6),PROD_TYPE:C(14),PRO
0080:D_REV:C(5),HOSTID:C(60),AUTHNUM:C(10),EXPIRE:C(11),OPEN_STRING:C(24),USER
0080:S:N(4),LIC_COUNT:N(4),TEMP_COUNT:N(4),OPEN_NUM:N(4)"
0090 ENTER SN$,AUTHNUM$,EMAIL$,FAXNUM$,TO$,LICENSE$
0091 REM '**************************************************************************
0092 REM ' Licenses will no longer be sent out implicitly as of 8/26/2009
0093 REM ' user must register their license explicitly through their software.
0094 REM ' change made by Kurt Williams 8/26/2009
0095 REM '**************************************************************************
0096 GOTO EOJ
0100 LET FILES=2; DIM F[FILES]
0110 LET SN_LIC=UNT; OPEN (SN_LIC)"sn_license.dat"
0120 LET F[1]=SN_LIC
0130 LET SN$=SN$+FILL(20),SN$=SN$(1,20),HOSTID$="",LICENSE$=""
0140 LET AVAILSN_LICENSE=0
0150 READ RECORD (SN_LIC,KEY=CVS(SN$,2),DOM=READREC)
0160 READREC: READ RECORD (SN_LIC,END=DONE)SN_LICENSE$
0170 IF POS(SN_LICENSE.SERIAL_NUM$=SN$)<>1 THEN GOTO DONE
0180 LET AVAILSN_LICENSE=1,HOSTID$=SN_LICENSE.HOSTID$
0190 GOTO READREC
0200 DONE: 
0210 IF HOSTID$="" THEN GOTO EOJ
0220 LET LIC_DELIVERY$="",MAILFILE$=stbl("TEMP")+CVS(SN$,3)+"auto.txt",LICFILE$=STBL("FLEXHOME")+"lic/"+CVS(SN$,3)+".lic"
0230 IF FAXNUM$<>"" THEN LET LIC_DELIVERY$="fax"
0240 IF EMAIL$<>"" THEN LET LIC_DELIVERY$="email"
0250 IF LIC_DELIVERY$<>"" THEN GOTO AUTORESPONDER
0270 GOTO LICFILE
0280 AUTORESPONDER: 
0290 LET MAILTEXT$="To: license@basis.cloud"+$0A$+"From: customer-service@basis.cloud"+$0A$+"S
0290:ubject: License"+$0A$+$0A$
0300 LET MAILTEXT$=MAILTEXT$+"Company          : "+$0A$
0310 LET MAILTEXT$=MAILTEXT$+"Last Name        : "+TO$+$0A$
0320 LET MAILTEXT$=MAILTEXT$+"First Name       : "+$0A$
0330 LET MAILTEXT$=MAILTEXT$+"Phone Number     : "+$0A$
0340 LET MAILTEXT$=MAILTEXT$+"Fax Number       : "+CVS(FAXNUM$,3)+$0A$
0350 LET MAILTEXT$=MAILTEXT$+"Email Address    : "+CVS(EMAIL$,3)+$0A$
0360 LET MAILTEXT$=MAILTEXT$+"Host Name        : "+$0A$
0370 LET MAILTEXT$=MAILTEXT$+"Host ID          : "+CVS(HOSTID$,3)+$0A$
0380 LET MAILTEXT$=MAILTEXT$+"Serial Number    : "+CVS(SN$,3)+$0A$
0390 LET MAILTEXT$=MAILTEXT$+"License Auth Num : "+AUTHNUM$+$0A$
0400 LET MAILTEXT$=MAILTEXT$+"License Delivery : "+LIC_DELIVERY$+$0A$
0405 LET MAILTEXT$=MAILTEXT$+"AutoResponderForceCheck: false"+$0A$
0410 ERASE LICFILE$,ERR=MAILFILE
0420 MAILFILE: 
0430 ERASE MAILFILE$,ERR=STRINGIT
0440 STRINGIT: 
0450 STRING MAILFILE$
0460 LET MCHN=UNT
0470 OPEN (MCHN,ERR=EOJ)MAILFILE$
0480 WRITE RECORD (MCHN)MAILTEXT$
0490 CLOSE (MCHN)
0495 rem ' this program is no longer used
0496 rem ' the unix send mail command is no longer used
0500 rem ' LET A=SCALL("/usr/lib/send mail -t < "+MAILFILE$)
0510 IF A=0 THEN WAIT 3
0520 ERASE MAILFILE$,ERR=LICFILE
0530 LICFILE: 
0540 LET LCHN=UNT
0550 OPEN (LCHN,ERR=EOJ)LICFILE$
0560 LET FIN$=FIN(LCHN),FILSIZ=DEC(FIN$(1,4))
0570 READ RECORD (LCHN,SIZ=FILSIZ,ERR=FILE_END)LICENSE$
0580 FILE_END: 
0590 CLOSE (LCHN)
0600 EOJ: 
0610 IF FILES<1 THEN GOTO EXIT
0620 FOR I=1 TO FILES; CLOSE (F[I],ERR=NEXTI)
0630 NEXTI: NEXT I
0640 EXIT: 
0650 EXIT
9000 REM 9000 " --- Standard Error Routine (15May95)"
9010 GOTO EOJ
9020 IF ERR=127 THEN GOTO 9120
9030 CALL "SYC.EA",ERR=9070,EXIT_CTRL,PGM(-2),ERR,TCB(5),E$,E1,E2
9040 IF E1=1 THEN GOTO 9080
9050 IF E1=3 THEN GOTO 9100
9060 PRINT @(0,E2),'CL','CURSOR'("ON"),E$,'LF'
9070 ESCAPE
9080 REM " --- Retry"
9090 RETRY
9100 REM " --- Return"
9110 GOTO 9180
9120 REM " --- Standard Escape Routine"
9130 CALL "SYC.ES",ERR=9160,PGM(-2),TCB(8),E$,E2,V3
9140 IF V3<>127 THEN GOTO 9170
9150 PRINT @(0,E2),'CL','CURSOR'("ON"),E$,'LF'
9160 ESCAPE
9170 RETURN
9180 REM " --- Return to calling program"
9190 EXIT
9200 END
