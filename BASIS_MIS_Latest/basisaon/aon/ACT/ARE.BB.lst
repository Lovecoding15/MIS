0010 REM "ARE - INVOICE ENTRY"
0020 REM "Program ARE.BB"
0022 REM "+-----------------------------------------------------------+"
0024 REM "| ADD+ON Software, Inc. Advantage/V Version 6.0.0 - 15May96 |"
0026 REM "|      Copyright (c) 1996 Open Systems Holdings Corp.       |"
0028 REM "|                  All Rights Reserved                      |"
0030 REM "+-----------------------------------------------------------+"
0040 REM 
0085 SETESC 9000
0090 SETERR 9000
0095 PRECISION 4
0100 REM " --- Open/Lock Files
0200 REM " --- IOLists
0220 ARE02A: IOLIST B0$,B[0],B[1]
0250 ARM10D: IOLIST X0$
0260 ARM10A: IOLIST X0$,X[ALL]
0500 REM " --- Init Data
0510 DIM X[2],MESSAGE$[1]
0590 LET W0$="  ",B0$(1)=N0$+W0$+A0$(3,6)
0900 REM " --- Init File
0920 READ (ARE02_DEV,KEY=N0$+W0$+A0$(3,6),DOM=0930)
1000 REM " --- Key
1010 PRINT 'CF',
1020 LET V2$="",V2$=KEY(ARE02_DEV,END=1050)
1025 IF LEN(V2$)<10 THEN LET V2$=J$(1,10)
1030 IF V2$(1,10)<>N0$+W0$+A0$(3,6) THEN LET V2$=""
1040 IF V2$<>"" THEN LET V2$=V2$(11,7)
1045 IF POS("A"=V2$)>0 THEN LET V2$=""
1050 LET V0$="Z",V1$="KE",V0=7,V1=15,V2=6
1060 GOSUB 7000
1070 IF V3=4 THEN RUN "ARE.BA"
1090 IF V$="" THEN GOTO 0900
1100 LET B0$(11,7)=V$
1110 PRINT @(V1,V2),B0$(11,7)
1200 REM " --- Find Key
1210 LET O9=0
1220 FIND (ARE02_DEV,KEY=B0$(1,17),DOM=1250)IOL=ARE02A
1230 GOTO 1300
1250 FIND (ART01_DEV,KEY=B0$(1,17)+"00",DOM=1400)
1270 LET MESSAGE$[0]="This Invoice Already Exists (<Enter>=Continue)"
1280 CALL "SYC.XA",2,MESSAGE$[ALL],0,22,-1,V$,V3
1290 GOTO 1000
1300 REM " --- Display
1320 GOSUB 5000
1340 GOTO 4000
1400 REM " --- New Record
1410 CALL "SYC.YN",1,"Is This A New Record",2,V$,V3
1440 ON POS(V$="YN") GOTO 1400,1500,1000
1500 REM " --- Set-Up
1510 LET B0$(21)="",B0$(31,1)="S"
1520 DIM B[2]
1540 LET B0$(18,2)=Y0$(8,2),B0$(20,2)=Y0$(4,2)
2000 REM " --- Dist Code
2010 LET O9=1
2020 LET V0$="S",V1$="KCR",V2$=B0$(18,2),V0=2,V1=15,V2=7,I0=0,V4$="Enter A Valid Distribution Code (<F3>=Lookup)"
2030 GOSUB 7000
2031 IF V3<>3 THEN GOTO 2035
2032 LET V4=1,V5=ARM10_DEV,V6=4,V7=2,V8=6,V9=20,V5$="D"
2033 CALL "SYC.LZ",V1,V2,V4,V5,V6,V7,V8,V9,V$,V5$,N0$
2034 IF V$="" THEN GOTO 2000
2035 IF V3=2 THEN GOTO 1000
2040 LET B0$(18,2)=V$
2050 FIND (ARM10_DEV,KEY=N0$+"D"+B0$(18,2),DOM=2000)IOL=ARM10D
2060 PRINT @(V1+3,V2),X0$(6,20),
2090 GOTO 3900
2100 REM " --- Terms
2120 LET V0$="S",V1$="KCR",V2$=B0$(20,2),V0=2,V1=15,V2=8,V4$="Enter A Valid Terms Code (<F3>=Lookup)"
2130 GOSUB 7000
2132 IF V3<>3 THEN GOTO 2140
2134 LET V4=1,V5=ARM10_DEV,V6=4,V7=2,V8=6,V9=20,V5$="A"
2136 CALL "SYC.LZ",V1,V2,V4,V5,V6,V7,V8,V9,V$,V5$,N0$
2138 IF V$="" THEN GOTO 2100
2140 LET B0$(20,2)=V$
2150 FIND (ARM10_DEV,KEY=N0$+"A"+B0$(20,2),DOM=2100)IOL=ARM10A
2160 PRINT @(V1+3,V2),X0$(6,20),
2190 GOTO 3900
2200 REM " --- Inv Date
2210 IF B0$(22,3)="   " THEN LET B0$(22,3)=F0$(7,3); REM "Set to Terminal Date
2220 LET V0$="D",V1$="R",V2$=B0$(22,3),V0=8,V1=15,V2=9
2240 GOSUB 7000
2250 LET B0$(22,3)=V$
2260 GOSUB 6200
2290 GOTO 3900
2300 REM " --- Due Date
2320 LET V0$="D",V1$="R",V2$=B0$(25,3),V0=8,V1=15,V2=10
2340 GOSUB 7000
2360 LET B0$(25,3)=V$
2390 GOTO 3900
2400 REM " --- Discount Date
2420 LET V0$="D",V1$="R",V2$=B0$(28,3),V0=8,V1=15,V2=11
2440 GOSUB 7000
2460 LET B0$(28,3)=V$
2490 GOTO 3900
2500 REM " --- Type
2520 LET V0$="S",V1$="CR",V2$=B0$(31,1),V3$="SRF",V4$="S=Sale  R=Return  F=Finance Charge",V0=1,V1=15,V2=12
2540 GOSUB 7000
2560 LET B0$(31,1)=V$
2570 IF V$="S" THEN LET V$="Sale" ELSE IF V$="R" THEN LET V$="Return" ELSE LET V$="Finance Charge"
2580 PRINT @(V1,V2),'CL',V$,
2590 GOTO 3900
2600 REM " --- Amt
2620 LET V0$="N",V2$=STR(B[0]),V3$=M1$,V1=15,V2=13
2640 GOSUB 7000
2660 LET B[0]=V
2670 LET B[1]=B[0]*X[0]/100
2680 PRINT @(15,14),B[1]:M1$,
2690 GOTO 3900
2700 REM " --- Discount
2720 LET V0$="N",V2$=STR(B[1]),V3$=M1$,V1=15,V2=14
2740 GOSUB 7000
2760 LET B[1]=V
2790 GOTO 3900
3900 REM " --- Next Field
3910 IF V3<>2 THEN GOTO 3940
3920 IF I0>0 THEN LET I0=I0-1
3930 GOTO 3950
3940 LET I0=I0+1
3960 ON I0 GOTO 2000,2100,2200,2300,2400,2500,2600,2700,3990
4000 REM " --- Options
4010 LET V0$="S",V1$="KC",V2$="",V3$="",V4$="Is The Above Information Correct (Y/N/Delete)?",V0=6,V1=FNV(V4$),V2=22
4020 GOSUB 7000
4030 IF V$="DELETE" THEN GOTO 4200
4040 IF V$="" THEN IF O9=0 THEN GOTO 1000
4050 ON POS(V$="YN") GOTO 4000,4100,2000
4100 REM " --- Write
4120 WRITE (ARE02_DEV,KEY=B0$(1,17))IOL=ARE02A
4190 GOTO 1000
4200 REM " --- Delete
4220 REMOVE (ARE02_DEV,KEY=B0$(1,17),DOM=4230)
4290 GOTO 1000
5000 REM " --- Display
5020 PRINT @(15,7),B0$(18,2),@(15,8),B0$(20,2),@(15,9),FNB$(B0$(22,3)),@(15,10),FNB$(B0$(25,3)),@(15,11),FNB$(B0$(28,3)),@(15,12),B0$(31,1),@(15,13),B[0]:M1$,@(15,14),B[1]:M1$,
5030 IF B0$(31,1)="S" THEN LET V$="Sale" ELSE IF B0$(31,1)="R" THEN LET V$="Return" ELSE LET V$="Finance Charge"
5040 PRINT @(15,12),V$,
5090 RETURN 
6200 REM " --- Create Due&Disc
6220 LET V=X[1]
6230 CALL "SYC.CD",X0$(26,1),B0$(22,3),V,V$,STATUS
6240 LET B0$(25,3)=V$,V=X[2]
6260 CALL "SYC.CD",X0$(26,1),B0$(22,3),V,V$,STATUS
6270 LET B0$(28,3)=V$
6280 PRINT @(15,10),FNB$(B0$(25,3)),@(15,11),FNB$(B0$(28,3)),
6290 RETURN 
7000 REM " --- Standard Input Routine (15May95)"
7010 CALL "SYC.IA",V0$,V1$,V2$,V3$,V4$,PGM(-2),V0,V1,V2,V$,V,V3,DISPLAY_LEN
7020 IF V3=999 THEN GOTO 7200
7030 IF V3=127 THEN GOTO 7100
7090 RETURN 
7100 REM " --- Escape During Input"
7110 CALL "SYC.ES",ERR=7200,PGM(-2),TCB(8),E$,E2,V3
7120 IF V3<>127 THEN GOTO 7000
7130 PRINT @(0,E2),'CL','CURSOR'("ON"),E$,'LF'
7200 REM " --- Error During Input"
7210 ESCAPE
7290 GOTO 7000
8000 REM "FUNCTIONS"
8010 DEF FNA$(Q$,Q2$)=STR(MOD((ASC(Q$)-32)*POS(" "<>Q2$(2,1)),100):"00")
8020 DEF FNB$(Q1$)=FNA$(Q1$(2),Q1$)+"/"+FNA$(Q1$(3),Q1$)+"/"+FNA$(Q1$(1),Q1$)
8070 DEF FNV(Q$)=42+INT(LEN(Q$)/2)
8145 REM " --- FNYY21_YY$ Un-Convert 21st Century 2-Char Year to 2-Char Year"
8150 DEF FNYY21_YY$(Q1$)
8155 LET Q3$=" 01234567890123456789",Q1$(1,1)=Q3$(POS(Q1$(1,1)=" 0123456789ABCDEFGHIJ"))
8160 RETURN Q1$
8165 FNEND
9000 REM " --- Standard Error Routine (15May95)"
9010 IF ERR=127 THEN GOTO 9300
9020 CALL "SYC.EA",ERR=9090,EXIT_CTRL,PGM(-2),ERR,TCB(5),E$,E1,E2
9030 IF E1=1 THEN GOTO 9100
9040 IF E1=3 THEN GOTO 9200
9080 PRINT @(0,E2),'CL','CURSOR'("ON"),E$,'LF'
9090 ESCAPE
9100 REM " --- Retry"
9190 RETRY
9200 REM " --- Return"
9290 GOTO 9900
9300 REM " --- Standard Escape Routine"
9310 CALL "SYC.ES",ERR=9350,PGM(-2),TCB(8),E$,E2,V3
9320 IF V3<>127 THEN GOTO 9390
9330 PRINT @(0,E2),'CL','CURSOR'("ON"),E$,'LF'
9350 ESCAPE
9390 RETURN 
9900 RUN "SYS.AA"
9999 END
