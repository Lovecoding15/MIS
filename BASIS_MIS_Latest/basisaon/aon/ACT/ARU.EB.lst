0010 REM "ARU - Age A/R (No Report)"
0020 REM "Program ARU.EB"
0022 REM "+-----------------------------------------------------------+"
0024 REM "| ADD+ON Software, Inc. Advantage/V Version 6.0.0 - 15May96 |"
0026 REM "|      Copyright (c) 1996 Open Systems Holdings Corp.       |"
0028 REM "|                  All Rights Reserved                      |"
0030 REM "+-----------------------------------------------------------+"
0040 REM 
0085 SETESC 9000
0090 SETERR 9000
0100 REM " --- Open/Lock Files"
0200 REM " --- IOLISTS's"
0210 ART01A: IOLIST A0$,A[ALL]
0220 ART11A: IOLIST W0$,W1$(1),W[ALL]
0230 ARM01A: IOLIST B0$,B1$
0240 ARM02A: IOLIST C0$,C1$,C[ALL]
0250 ARM10A: IOLIST H3$
0500 REM " --- Initializations"
0540 DIM A[1],C[10],W1$(11),W[1],Y[6]
0600 REM " --- Determine 30-Day Aging Period Dates"
0610 LET H4$=""
0620 FOR X=-5 TO 0
0630 LET X$=""
0640 CALL "SYC.CA",AGEDT$,X$,X*30
0650 IF X$="N" THEN EXITTO 9900
0660 LET H4$=X$+H4$
0670 NEXT X
0700 REM " --- Background"
0720 CALL "SYC.NB","Aging",M0,COLUMN
0940 REM " --- Disallow 'M'enu option in Error Routine
0950 LET EXIT_CTRL=1
1000 REM " --- Init Read
1010 LET T1$="",T9$=""
1020 READ (ART01_DEV,KEY=N0$+"  "+START$,DOM=1030)
1030 READ (ARM04_DEV,KEY=N0$+"A",DOM=1040)
1100 REM " --- Main Read"
1120 LET K$=KEY(ART01_DEV,END=4000)
1130 IF POS(N0$=K$)<>1 THEN GOTO 4000
1140 READ (ART01_DEV,KEY=K$)IOL=ART01A
1155 IF END$<>"" THEN IF A0$(5,P[0])>END$ THEN GOTO 4020
1170 LET Y0=A[0]
1180 PRINT @(COLUMN,11),FNF$(A0$(5,P[0]),M0$),
1200 REM " --- Breaks"
1220 IF K$(3,2)<>T0$ THEN GOSUB 6000
1240 IF K$(5,6)<>T1$ THEN GOSUB 6400
2000 REM " --- Init to check detail
2010 READ (ART11_DEV,KEY=A0$(1,17),DOM=2100)
2100 REM " --- Check Detail"
2110 LET K11$=KEY(ART11_DEV,END=2200)
2120 IF K11$(1,17)<>A0$(1,17) THEN GOTO 2200
2130 READ (ART11_DEV)IOL=ART11A
2150 IF W1$(1,1)=" " THEN GOTO 2180
2170 LET Y0=Y0+W[0]+W[1]
2190 GOTO 2100
2300 REM " --- Date"
2320 IF DATE$="I" THEN LET X3$=A0$(24,3) ELSE LET X3$=A0$(27,3)
2400 REM " --- Age"
2420 LET X0=POS(X3$>H4$,3)
2440 IF X0=0 THEN LET X0=5 ELSE LET X0=INT(X0/3)
2600 REM " --- Accumulate"
2620 LET Y[X0]=Y[X0]+Y0
2900 GOTO 1100
4000 REM " --- Totals"
4020 LET T9$="E"
4040 GOSUB 6000
4100 GOTO 9900
6000 REM " --- AR Type"
6010 IF T0$="" THEN GOTO 6100
6030 GOSUB 6400
6040 IF P3$(1,1)<>"Y" THEN GOTO 6100
6100 IF T9$="E" THEN RETURN 
6120 DIM T[5]
6140 LET T0$=A0$(3,2),T9$=""
6150 IF P3$(1,1)<>"Y" THEN RETURN 
6160 LET H3$=""
6170 FIND (ARM10_DEV,KEY=N0$+"A"+T0$,DOM=6290)IOL=ARM10A
6180 LET H3$=H3$(6,20),X=POS("  "=H3$)
6190 IF X>1 THEN LET H3$=H3$(1,X-1)
6290 RETURN 
6400 REM " --- Customer Break"
6410 IF T1$="" THEN GOTO 6500
6450 LET C[0]=Y[0],C[1]=Y[1],C[2]=Y[2],C[3]=Y[3],C[4]=Y[4],C[5]=Y[5]
6470 WRITE (ARM02_DEV,KEY=C0$)IOL=ARM02A
6500 IF T9$<>"" THEN RETURN 
6510 DIM X1$(M0),C1$(40),C[10]
6520 LET X0$="Not On File",X2$="",C0$=N0$+A0$(5,6)+A0$(3,2)
6550 FIND (ARM01_DEV,KEY=N0$+A0$(5,6),DOM=6570)IOL=ARM01A
6560 LET X0$=B1$(1,30),X2$=FNF$(B1$(112,10),H$)
6570 LET X1$(1)=FNF$(A0$(5,P[0]),M0$)
6575 EXTRACT (ARM02_DEV,KEY=N0$+A0$(5,6)+A0$(3,2),DOM=6580)IOL=ARM02A
6580 LET T1$=A0$(5,6)
6710 DIM Y[5]
6790 RETURN 
8000 REM " --- Functions"
8010 DEF FNA$(Q$,Q2$)=STR(MOD((ASC(Q$)-32)*POS(" "<>Q2$(2,1)),100):"00")
8020 DEF FNB$(Q1$)=FNA$(Q1$(2),Q1$)+"/"+FNA$(Q1$(3),Q1$)+"/"+FNA$(Q1$(1),Q1$)
8030 DEF FNC$(Q1$)=FNA$(Q1$(2),Q1$)+FNA$(Q1$(3),Q1$)+FNA$(Q1$(1),Q1$)
8200 REM " --- FNF$ AlphaNumeric Masking Function"
8210 DEF FNF$(Q1$,Q2$)
8220 IF Q2$="" THEN LET Q2$=FILL(LEN(Q1$),"0")
8230 RETURN STR(-NUM(Q1$,ERR=ALPHA_FNF):Q2$,ERR=ALPHA_FNF)
8240 ALPHA_FNF: 
8245 LET Q=1,Q0=0
8250 WHILE LEN(Q2$(Q))
8255 IF POS(Q2$(Q,1)="-()") THEN LET Q0=Q0+1 ELSE LET Q2$(Q,1)="X"
8260 LET Q=Q+1
8265 WEND
8270 IF LEN(Q1$)>LEN(Q2$)-Q0 THEN LET Q1$=Q1$(1,LEN(Q2$)-Q0)
8280 RETURN STR(Q1$:Q2$)
8290 FNEND
9000 REM " --- Standard Error Routine (15May95)"
9010 IF ERR=127 THEN GOTO 9300
9020 CALL "SYC.EA",ERR=9090,EXIT_CTRL,PGM(-2),ERR,TCB(5),E$,E1,E2
9030 IF E1=1 THEN GOTO 9100
9040 IF E1=3 THEN GOTO 9200
9080 PRINT @(0,E2),'CL','CURSOR'("ON"),E$,'LF'
9090 ESCAPE
9100 REM " --- Retry"
9190 RETRY
9200 REM " --- Return"
9290 GOTO 9900
9300 REM " --- Standard Escape Routine"
9310 CALL "SYC.ES",ERR=9350,PGM(-2),TCB(8),E$,E2,V3
9320 IF V3<>127 THEN GOTO 9390
9330 PRINT @(0,E2),'CL','CURSOR'("ON"),E$,'LF'
9350 ESCAPE
9390 RETURN 
9900 RUN "SYS.AA"
9999 END
