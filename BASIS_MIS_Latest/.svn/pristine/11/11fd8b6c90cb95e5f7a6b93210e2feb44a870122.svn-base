0001 REM <genlicauth.bbx>
0010 SETERR EXIT
0020 ENTER SERIALNUM$,FLOAT$,ORDERNUM$,AUTHNUM$
0030 LET SNUM$=CVS(SERIALNUM$,2),ONUM$=CVS(ORDERNUM$,2)
0040 IF LEN(SNUM$)<9 THEN GOTO EXIT
0050 IF POS(SNUM$(1,3)="OSH") THEN LET OEM=1 ELSE LET OEM=0
0060 IF ONUM$="" AND OEM THEN GOSUB OEM_PREFIX
0070 IF LEN(ONUM$)<5 THEN GOTO EXIT
0080 LET L4$=SNUM$(LEN(SNUM$)-3,4)
0090 IF FLOAT$<>"N" THEN LET L4$=L4$+"1" ELSE LET L4$=L4$+"0"
0100 LET AUTHNUM$=ONUM$(LEN(ONUM$)-4,5)+L4$
0110 GOTO EXIT
0120 OEM_PREFIX: 
0130 LET NUMFILE$=STBL("AON")+"ADATA/oemnumbers.dat"
0140 LET NUMCHAN=UNT,K$=SERIALNUM$(1,3)
0150 OPEN (NUMCHAN)NUMFILE$
0160 EXTRACT RECORD (NUMCHAN,KEY=K$,DOM=END_OEM_PREFIX)NUMREC$
0170 IF LEN(NUMREC$)<14 THEN GOTO END_OEM_PREFIX
0180 LET ONUM$=NUMREC$(10,5),NXTP=NUM(NUMREC$(10,5))+1,NUMREC$(10,5)=STR(NXTP:
0180:"00000")
0190 WRITE RECORD (NUMCHAN,KEY=K$)NUMREC$
0200 END_OEM_PREFIX: IF NUMCHAN THEN CLOSE (NUMCHAN)
0210 RETURN
9900 REM 9900
9910 EXIT: 
9920 EXIT
