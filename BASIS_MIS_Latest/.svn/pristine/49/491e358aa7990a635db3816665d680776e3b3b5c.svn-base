0010 REM "Invoice/order lookup"
0020 REM "Program BOI.01"
0050 BEGIN
0085 SETESC 9000
0090 SETERR 9000
0100 REM " --- Open/Lock Files "
0110 LET FILES=9
0115 DIM FILES$[FILES],OPTIONS$[FILES],CHANNELS[FILES]
0120 LET FILES$[1]="ARE-03",FILES$[2]="ART-03",FILES$[3]="ARE-33"
0125 LET FILES$[4]="ART-33",FILES$[5]="ARM-01",FILES$[6]="ARM-03"
0130 LET FILES$[7]="TMM-01",FILES$[8]="SYS-01",FILES$[9]="ARE-43"
0150 CALL "SYC.DA",1,1,FILES,FILES$[ALL],OPTIONS$[ALL],CHANNELS[ALL],BATCH,STA
0150:TUS
0155 IF STATUS>0 THEN GOTO 9900
0160 LET ARE03_DEV=CHANNELS[1],ART03_DEV=CHANNELS[2],ARE33_DEV=CHANNELS[3]
0165 LET ART33_DEV=CHANNELS[4],ARM01_DEV=CHANNELS[5],ARM03_DEV=CHANNELS[6]
0170 LET TMM01_DEV=CHANNELS[7],SYS01_DEV=CHANNELS[8],ARE43_DEV=CHANNELS[9]
0200 REM " --- IOLists"
0210 ARM01: IOLIST A0$,A1$
0220 ARM03: IOLIST C0$,C1$
0230 ARE33: IOLIST B0$,B1$
0240 ART33: IOLIST B0$,B1$
0290 SYS01T: IOLIST X$,F0$,X$,X$,X$,F4$,F5$
0300 ARE03: IOLIST D0$,A[ALL]
0310 ART03: IOLIST D0$,A[ALL]
0400 REM " --- Parameters"
0410 FIND (SYS01_DEV,KEY="T"+FID(0),DOM=9800)IOL=SYS01T
0420 LET N0$=F0$(16,2)
0500 REM " --- Initialize Data"
0520 DIM A[10]
0700 REM " --- Background"
0710 PRINT 'SB',@(10,3),"Find an Invoice/Order (Current or History) by:"
0720 PRINT @(10,5),"Invoice Number:",@(21,6),"or",@(12,7),"Order Number:"
0750 PRINT @(21,8),"or",@(9,9),"Customer Number:",@(34,9),"and PO Number:",'SF
0750:',
1000 REM " --- Invoice
1010 PRINT 'CF',
1020 LET V2$="",V1=26,V2=5,V4$="Invoice# of a current or historical invoice"
1040 GOSUB 10100; IF V3=4 THEN GOTO 9900
1060 LET P5$=V$; IF NUM(V$,ERR=1200)=0 THEN GOTO 1200
1070 FIND (ART03_DEV,KEY=N0$+P5$,KNUM=1,DOM=1100)IOL=ART03
1080 LET HISTORY=1; GOTO 4000
1100 LET HISTORY=0; READ (ARE03_DEV,KEY=N0$,DOM=1110)
1110 READ (ARE03_DEV,END=1150)IOL=ARE03; IF POS(N0$=D0$)<>1 THEN GOTO 1150
1120 IF POS(P5$=D0$)=42 THEN GOTO 4000 ELSE GOTO 1110
1150 LET V2$="",V1=26,V2=5,V4$=P5$+" Not found"; GOTO 1040
1200 REM " --- Order
1220 LET V2$="",V1=26,V2=7,V4$="Order# of a current order/invoice"
1240 GOSUB 10100; IF V3=4 THEN GOTO 9900
1260 LET P5$=V$; IF NUM(V$,ERR=1400)=0 THEN GOTO 1400
1300 LET HISTORY=0; READ (ARE03_DEV,KEY=N0$,DOM=1310)
1310 READ (ARE03_DEV,END=1350)IOL=ARE03; IF POS(N0$=D0$)<>1 THEN GOTO 1350
1320 IF POS(P5$=D0$)=11 THEN GOTO 4000 ELSE GOTO 1310
1350 LET V2$="",V1=26,V2=7,V4$=P5$+" Not found"; GOTO 1240
1400 REM " --- Customer and PO
1410 LET V4$=""
1420 LET V2$="",V1=26,V2=9,V0$="Z",V1$="K",V3$="",V0=6
1440 GOSUB 7000; PRINT @(V1,V2),V$; IF V3=4 THEN GOTO 9900
1460 LET P5$=V$; IF NUM(V$,ERR=1000)=0 THEN GOTO 1000
1470 LET V1=49,V2=9,V4$="PO# of a current or historical invoice",V0$="",V1$=""
1470:,V3$="",V0=20
1480 GOSUB 7000; IF V3=4 THEN GOTO 9900
1490 LET P6$=CVS(V$,2); IF P6$="" THEN GOTO 1000
1500 LET HISTORY=0,K$=N0$+"  "+P5$; READ (ARE03_DEV,KEY=K$,DOM=1510)
1510 READ (ARE03_DEV,END=1540)IOL=ARE03; IF POS(K$=D0$)<>1 THEN GOTO 1540
1520 LET P=(POS(P6$=D0$)>48); IF P>48 AND P<59-LEN(P6$) THEN GOTO 4000 ELSE GO
1520:TO 1510
1540 LET HISTORY=1,K$=N0$+"  "+P5$; READ (ART03_DEV,KEY=K$,KNUM=0,DOM=1550)
1550 READ (ART03_DEV,END=1590)IOL=ART03; IF POS(K$=D0$)<>1 THEN GOTO 1590
1560 LET P=POS(P6$=D0$); IF P>48 AND P<59-LEN(P6$) THEN GOTO 4000 ELSE GOTO 15
1560:50
1590 LET V4$=P5$+" "+P6$+" Not found"; GOTO 1420
4000 REM " --- Sold/ship addresses
4010 DIM B$(180),A1$(325)
4030 READ (ARM01_DEV,KEY=N0$+D0$(5,6),DOM=4050)IOL=ARM01
4050 LET B$=A1$(31,72)+A1$(179,48)+A1$(103,9)
4060 CALL "SYC.AA",B$,24,5,9,30
4100 READ (TMM01_DEV,KNUM=0,KEY=N0$+D0$(5,6),DOM=*next)
4110 LET TMM01_K$=KEY(TMM01_DEV,END=4200)
4120 IF POS(N0$+D0$(5,6)=TMM01_K$)<>1 THEN GOTO 4200
4130 READ (TMM01_DEV,KEY=TMM01_K$)TMM0$
4140 LET B$=TMM0$(142,60)+TMM0$(389,60)+TMM0$(202,25)+" "+TMM0$(227,2)+"  "+TMM0$(275,2)+FILL(28," ")+TMM0$(229,9)
4150 CALL "SYC.AX",B$,30,6,9,30
4200 LET B$=A1$(1,30)+B$
4500 REM " --- Ship-To"
4510 LET C$=B$
4520 IF CVS(D0$(102,6),2)="" THEN GOTO 4690
4530 DIM C1$(190)
4540 IF D0$(102,6)<>"000099" THEN GOTO 4600
4550 IF HISTORY=0 THEN FIND (ARE33_DEV,KEY=N0$+D0$(5,13),DOM=4690)IOL=ARE33
4555 IF HISTORY THEN FIND (ART33_DEV,KEY=N0$+D0$(5,13),DOM=4690)IOL=ART33
4560 LET C1$=B1$(1,90)+FILL(30)+B1$(91); GOTO 4630
4600 FIND (ARM03_DEV,KEY=N0$+D0$(5,6)+D0$(102,6),DOM=4690)IOL=ARM03
4630 LET C$=C1$(31,90)+FILL(30)+C1$(121,25)+" "+C1$(146,2)+"  "+C1$(157,15)+FI
4630:LL(15," ")+C1$(148,9)
4640 CALL "SYC.AX",C$,30,6,9,30
4650 LET C$=C1$(1,30)+C$
4690 IF LEN(C$)<LEN(B$) THEN LET C$=C$+FILL(40); GOTO 4690
5010 REM set up for Taos call
5020 IF HISTORY THEN LET FILENAME$="(BBX)invhist.bbx" ELSE LET FILENAME$="(BBX
5020:)ordhist.bbx"
5030 REM First, check if this has already been done
5040 LET A$=STBL("BBEXT",ERR=5100); GOTO 5140
5100 CALL STBL("EXT")+"_acu.utl"
5140 CALL STBL("BBEXT")+"_lkeymap.utl"
5170 CALL STBL("BBEXT")+"_rsteus.utl"
5180 CALL STBL("BBEXT")+"_setpath.utl",FILENAME$
5190 CALL FILENAME$,D0$(1,20),B$,C$
5200 CALL STBL("BBEXT")+"_rstold.utl"
5210 CALL STBL("BBEXT")+"_cleanup.utl"
5220 IF CVS(B$,7)<>"PRINT" THEN GOTO 1000
5230 LET PRINTER=UNT
5240 CALL "SYC.GA",PRINTER,1,"",PRTR$,STATUS
5250 IF STATUS THEN GOTO 1000
5260 CALL "BIN.12",D0$(11,7),PRINTER
5290 GOTO 0700
7000 REM " --- Standard Input Routine (15May95)"
7010 CALL "SYC.IA",V0$,V1$,V2$,V3$,V4$,PGM(-2),V0,V1,V2,V$,V,V3,DISPLAY_LEN
7020 IF V3=999 THEN GOTO 7200
7030 IF V3=127 THEN GOTO 7100
7090 RETURN
7100 REM " --- Escape During Input"
7110 CALL "SYC.ES",ERR=7200,PGM(-2),TCB(8),E$,E2,V3
7120 IF V3<>127 THEN GOTO 7000
7130 PRINT @(0,E2),'CL','CURSOR'("ON"),E$,'LF'
7200 REM " --- Error During Input"
7210 ESCAPE
7290 GOTO 7000
9000 REM " --- Standard Error Routine (15May95)"
9010 IF ERR=127 THEN GOTO 9300
9020 CALL "SYC.EA",ERR=9090,EXIT_CTRL,PGM(-2),ERR,TCB(5),E$,E1,E2
9030 IF E1=1 THEN GOTO 9100
9040 IF E1=3 THEN GOTO 9200
9080 PRINT @(0,E2),'CL','CURSOR'("ON"),E$,'LF'
9090 ESCAPE
9100 REM " --- Retry"
9190 RETRY
9200 REM " --- Return"
9210 SETERR 9000
9290 GOTO 9900
9300 REM " --- Standard Escape Routine"
9310 CALL "SYC.ES",ERR=9350,PGM(-2),TCB(8),E$,E2,V3
9320 IF V3<>127 THEN GOTO 9390
9330 PRINT @(0,E2),'CL','CURSOR'("ON"),E$,'LF'
9350 ESCAPE
9390 RETURN
9800 REM " --- Display Parameter record error"
9810 LET LINE_ERR$=LST(PGM(TCB(5)))
9820 CALL "SYC.YA",LINE_ERR$,N2$,ERR
9900 RUN "SYS.AA"
9999 END
10100 REM " --- Invoice "
10120 LET V0$="Z",V1$="K",V3$="",V0=7
10130 GOSUB 7000
10180 PRINT @(V1,V2),V$
10190 RETURN
46500 END
