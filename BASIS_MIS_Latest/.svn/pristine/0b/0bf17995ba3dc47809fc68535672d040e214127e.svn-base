0010 REM "OPX - FIX MTD TOTALS"
0020 REM "Program OPX.AA"
0022 REM "+-----------------------------------------------------------+"
0024 REM "| ADD+ON Software, Inc. Advantage/V Version 6.0.0 - 15May96 |"
0026 REM "|      Copyright (c) 1996 Open Systems Holdings Corp.       |"
0028 REM "|                  All Rights Reserved                      |"
0030 REM "+-----------------------------------------------------------+"
0031 REM "09Sep97 WGH: Write ARS-10 'C' and 'S' records correclty (220,510)
0040 REM 
0050 BEGIN 
0090 SETERR 9000
0095 SETESC 9000
0100 REM " --- Open/Lock Files "
0110 LET FILES=2
0120 DIM FILES$[FILES],OPTIONS$[FILES],CHANNELS[FILES]
0130 LET FILES$[1]="ARS-10",FILES$[2]="SYS-01"
0140 CALL "SYC.DA",1,1,2,FILES$[ALL],OPTIONS$[ALL],CHANNELS[ALL],BATCH,STATUS
0150 IF STATUS>0 THEN GOTO 9900
0160 LET ARS10_DEV=CHANNELS[1],SYS01_DEV=CHANNELS[2]
0200 REM " --- IOLISTS"
0210 ARS10S: IOLIST A0$(1),A[0],A[1],A[2],A[3],A[4],A[5],A[6],A[7],A[8],A[9],A[10],A[11],A[12],A[13],A[14],A[15]
0220 ARS10C: IOLIST C0$(1),C[ALL]
0230 ARS10A: IOLIST X$,P1$,P2$,P3$,P4$,M0$,M1$,M2$,M3$
0240 SYS01T: IOLIST X$,F0$,X$,X$,X$,F4$,F5$
0400 REM " --- Parameters "
0410 FIND (SYS01_DEV,KEY="T"+FID(0),DOM=9800)IOL=SYS01T
0420 LET N0$=F0$(16,2),N1$=F4$,N2$="AR",N4$=F5$
0430 FIND (SYS01_DEV,KEY=N0$+N2$+"00",DOM=9800)IOL=ARS10A
0500 REM " --- Initialize Data "
0510 DIM A0$(3),C0$(3),A[15],C[6]
0530 LET Z1=15,Z2=55
0700 REM ' --- Background "
0720 PRINT 'SB',@(12,6),"** Current Month **",@(52,6),"** Next Month **",
0730 PRINT @(8,8),"Sales: ",@(48,8),"Sales: ",@(6,9),"Returns: ",@(46,9),"Returns: ",@(10,10),"Tax: ",@(50,10),"Tax: ",@(6,11),"Freight: ",@(46,11),"Freight: ",@(9,12),"Cost: ",@(49,12),"Cost: ",@(5,13),"Discount: ",@(45,13),"Discount: ",@(3,14),"Cash Sales: ",@(43,14),"Cash Sales: ",
0740 PRINT @(9,15),"Cash: ",@(49,15),"Cash: ",@(0,16),"Cash Discount: ",@(40,16),"Cash Discount: ",@(2,17),"Cash To G/L: ",@(42,17),"Cash To G/L: ",
0750 PRINT 'SF',
1000 REM " --- Read Sales And Cash Records "
1010 PRINT 'CF',
1020 FIND (SYS01_DEV,KEY=N0$+N2$+"00",DOM=9800)
1030 FIND (ARS10_DEV,KEY=N0$+"S",DOM=1031)IOL=ARS10S
1040 FIND (ARS10_DEV,KEY=N0$+"C",DOM=1041)IOL=ARS10C
1050 GOSUB DISPLAY_DATA
1060 GOTO VERIFY_DISPLAY
2000 REM " --- Current Sales "
2010 LET V0$="N",V1$="",V2$=STR(A[0]),V3$=M1$,V4$="",V1=Z1,V2=8,I0=0
2020 GOSUB 7000
2030 LET A[0]=V
2040 GOTO 3900
2050 REM " --- Current Returns "
2060 LET V0$="N",V2$=STR(A[1]),V3$=M1$,V1=Z1,V2=9
2070 GOSUB 7000
2080 LET A[1]=V
2090 GOTO 3900
2100 REM " --- Current Tax "
2110 LET V0$="N",V2$=STR(A[2]),V3$=M1$,V1=Z1,V2=10
2120 GOSUB 7000
2130 LET A[2]=V
2140 GOTO 3900
2150 REM " --- Current Freight "
2160 LET V0$="N",V2$=STR(A[3]),V3$=M1$,V1=Z1,V2=11
2170 GOSUB 7000
2180 LET A[3]=V
2190 GOTO 3900
2200 REM " --- Current Cost "
2210 LET V0$="N",V2$=STR(A[4]),V3$=M1$,V1=Z1,V2=12
2220 GOSUB 7000
2230 LET A[4]=V
2240 GOTO 3900
2250 REM " --- Current Discount "
2260 LET V0$="N",V2$=STR(A[5]),V3$=M1$,V1=Z1,V2=13
2270 GOSUB 7000
2280 LET A[5]=V
2290 GOTO 3900
2300 REM " --- Current Cash Sales "
2310 LET V0$="N",V2$=STR(A[6]),V3$=M1$,V1=Z1,V2=14
2320 GOSUB 7000
2330 LET A[6]=V
2340 GOTO 3900
2350 REM " --- Current MTD Cash "
2360 LET V0$="N",V2$=STR(C[0]),V3$=M1$,V1=Z1,V2=15
2370 GOSUB 7000
2380 LET C[0]=V
2390 GOTO 3900
2400 REM " --- Current MTD Cash Discount "
2410 LET V0$="N",V2$=STR(C[1]),V3$=M1$,V1=Z1,V2=16
2420 GOSUB 7000
2430 LET C[1]=V
2440 GOTO 3900
2450 REM " --- Current MTD Cash To GL "
2460 LET V0$="N",V2$=STR(C[2]),V3$=M1$,V1=Z1,V2=17
2470 GOSUB 7000
2480 LET C[2]=V
2490 GOTO 3900
2500 REM " --- Next MTD Sales "
2510 LET V0$="N",V2$=STR(A[8]),V3$=M1$,V1=Z2,V2=8
2520 GOSUB 7000
2530 LET A[8]=V
2540 GOTO 3900
2550 REM " --- Next MTD Returns "
2560 LET V0$="N",V2$=STR(A[9]),V3$=M1$,V1=Z2,V2=9
2570 GOSUB 7000
2580 LET A[9]=V
2590 GOTO 3900
2600 REM " --- Next MTD Tax "
2610 LET V0$="N",V2$=STR(A[10]),V3$=M1$,V1=Z2,V2=10
2620 GOSUB 7000
2630 LET A[10]=V
2640 GOTO 3900
2650 REM " --- Next MTD Freight "
2660 LET V0$="N",V2$=STR(A[11]),V3$=M1$,V1=Z2,V2=11
2670 GOSUB 7000
2680 LET A[11]=V
2690 GOTO 3900
2700 REM " --- Next MTD Cost "
2710 LET V0$="N",V2$=STR(A[12]),V3$=M1$,V1=Z2,V2=12
2720 GOSUB 7000
2730 LET A[12]=V
2740 GOTO 3900
2750 REM " --- Next MTD Discount "
2760 LET V0$="N",V2$=STR(A[13]),V3$=M1$,V1=Z2,V2=13
2770 GOSUB 7000
2780 LET A[13]=V
2790 GOTO 3900
2800 REM " --- Next MTD Sales "
2810 LET V0$="N",V2$=STR(A[14]),V3$=M1$,V1=Z2,V2=14
2820 GOSUB 7000
2830 LET A[14]=V
2840 GOTO 3900
2850 REM " --- Next MTD Cash "
2860 LET V0$="N",V2$=STR(C[3]),V3$=M1$,V1=Z2,V2=15
2870 GOSUB 7000
2880 LET C[3]=V
2890 GOTO 3900
2900 REM " --- Next MTD Cash Discount "
2910 LET V0$="N",V2$=STR(C[4]),V3$=M1$,V1=Z2,V2=16
2920 GOSUB 7000
2930 LET C[4]=V
2940 GOTO 3900
2950 REM " --- Next MTD Cash To GL "
2960 LET V0$="N",V2$=STR(C[5]),V3$=M1$,V1=Z2,V2=17
2970 GOSUB 7000
2980 LET C[5]=V
2990 GOTO 3900
3900 REM " --- Next Field "
3910 IF V3<>2 THEN GOTO 3940
3920 IF I0>0 THEN LET I0=I0-1
3930 GOTO 3950
3940 LET I0=I0+1
3950 IF V3=4 THEN GOTO 4000
3960 ON I0 GOTO 2000,2050,2100,2150,2200,2250,2300,2350,2400,2450,2500,2550,2600,2650,2700,2750,2800,2850,2900,2950,4000
4000 REM " --- Verify Information Displayed "
4010 VERIFY_DISPLAY: 
4020 LET V4$="Is The Above Information Correct: "
4030 CALL "SYC.YN",1,V4$,2,V$,V3
4040 IF V3=4 THEN GOTO 9900
4050 ON POS(V$="YN") GOTO 4000,4100,2000
4100 WRITE (ARS10_DEV,KEY=N0$+"S")IOL=ARS10S
4110 WRITE (ARS10_DEV,KEY=N0$+"C")IOL=ARS10C
4190 GOTO 9900
5000 REM " --- Print Data On Screen "
5010 DISPLAY_DATA: 
5030 PRINT @(Z1,8),A[0]:M1$,@(Z2,8),A[8]:M1$,@(Z1,9),A[1]:M1$,@(Z2,9),A[9]:M1$,@(Z1,10),A[2]:M1$,@(Z2,10),A[10]:M1$,@(Z1,11),A[3]:M1$,@(Z2,11),A[11]:M1$
5040 PRINT @(Z1,12),A[4]:M1$,@(Z2,12),A[12]:M1$,@(Z1,13),A[5]:M1$,@(Z2,13),A[13]:M1$,@(Z1,14),A[6]:M1$,@(Z2,14),A[14]:M1$
5050 PRINT @(Z1,15),C[0]:M1$,@(Z2,15),C[3]:M1$,@(Z1,16),C[1]:M1$,@(Z2,16),C[4]:M1$,@(Z1,17),C[3]:M1$,@(Z2,17),C[5]:M1$
5090 RETURN 
7000 REM " --- Standard Input Routine (15May95)"
7010 CALL "SYC.IA",V0$,V1$,V2$,V3$,V4$,PGM(-2),V0,V1,V2,V$,V,V3,DISPLAY_LEN
7020 IF V3=999 THEN GOTO 7200
7030 IF V3=127 THEN GOTO 7100
7090 RETURN 
7100 REM " --- Escape During Input"
7110 CALL "SYC.ES",ERR=7200,PGM(-2),TCB(8),E$,E2,V3
7120 IF V3<>127 THEN GOTO 7000
7130 PRINT @(0,E2),'CL','CURSOR'("ON"),E$,'LF'
7200 REM " --- Error During Input"
7210 ESCAPE
7290 GOTO 7000
9000 REM " --- Standard Error Routine (15May95)"
9010 IF ERR=127 THEN GOTO 9300
9020 CALL "SYC.EA",ERR=9090,EXIT_CTRL,PGM(-2),ERR,TCB(5),E$,E1,E2
9030 IF E1=1 THEN GOTO 9100
9040 IF E1=3 THEN GOTO 9200
9080 PRINT @(0,E2),'CL','CURSOR'("ON"),E$,'LF'
9090 ESCAPE
9100 REM " --- Retry"
9190 RETRY
9200 REM " --- Return"
9290 GOTO 9900
9300 REM " --- Standard Escape Routine"
9310 CALL "SYC.ES",ERR=9350,PGM(-2),TCB(8),E$,E2,V3
9320 IF V3<>127 THEN GOTO 9390
9330 PRINT @(0,E2),'CL','CURSOR'("ON"),E$,'LF'
9350 ESCAPE
9390 RETURN 
9800 REM " --- Display Parameter record error"
9810 LET LINE_ERR$=LST(PGM(TCB(5)))
9820 CALL "SYC.YA",LINE_ERR$,N2$,ERR
9900 RUN "SYS.AA"
9999 END
