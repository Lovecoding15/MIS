0010 REM "ARE - INVOICE DATE MODIFICATION 2"
0020 REM "Program ARE.EB"
0022 REM "+-----------------------------------------------------------+"
0024 REM "| ADD+ON Software, Inc. Advantage/V Version 6.0.0 - 15May96 |"
0026 REM "|      Copyright (c) 1996 Open Systems Holdings Corp.       |"
0028 REM "|                  All Rights Reserved                      |"
0030 REM "+-----------------------------------------------------------+"
0040 REM 
0085 SETESC 9000
0090 SETERR 9000
0100 REM " --- Open/Lock Files
0200 REM " --- IOLists
0220 ARE06A: IOLIST B0$,B[ALL]
0250 ARM10A: IOLIST X0$,X[ALL]
0260 ARM10D: IOLIST X0$
0270 ART01A1: IOLIST C0$
0280 ART01A2: IOLIST X0$
0500 REM " --- Init Data
0510 LET W0$="  "
0520 LET B0$(1)=N0$+W0$+A0$(3,6)
0530 DIM X[2]
0900 REM " --- Init File
0920 READ (ARE06_DEV,KEY=N0$+W0$+A0$(3,6),DOM=0930)
1000 REM " --- Key
1010 PRINT 'CF',
1015 PRINT @(15,6),'CL',
1020 LET V2$="",V2$=KEY(ARE06_DEV,END=1050)
1030 IF V2$(1,10)<>N0$+W0$+A0$(3,6) THEN LET V2$=""
1040 IF V2$<>"" THEN LET V2$=V2$(11,7)
1050 LET V0$="Z",V1$="KEC",V4$="Valid Invoice Number For This Customer (<F3>=Display All Invoices)",V0=7,V1=15,V2=6,O9=0
1060 GOSUB 7000
1070 IF V3=4 THEN RUN "ARE.EA"
1080 IF V3=3 THEN GOTO 3000
1090 IF V$="" THEN GOTO 0900
1100 LET B0$(11,7)=V$
1200 REM " --- Find Key
1210 LET O9=0
1215 GOTO 1400
1220 FIND (ARE06_DEV,KEY=B0$(1,17),DOM=1400)IOL=ARE06A
1230 DIM MESSAGE$[1]
1235 LET MESSAGE$[0]="Invoice Has Not Been Posted To Open Invoices (<Enter>=Continue)"
1240 CALL "SYC.XA",2,MESSAGE$[ALL],0,22,-1,V$,V3
1250 GOTO 1000
1400 REM " --- Modify Open Invoice
1410 FIND (ART01_DEV,KEY=B0$(1,17)+"00",DOM=1000)IOL=ART01A1
1500 REM " --- Set-up
1510 LET B0$(21)="",B0$(31,1)="S"
1520 LET B0$(20,2)=C0$(22,2),B0$(22,9)=C0$(24,9)
1800 GOSUB 5000
1810 LET I0=0
1820 GOTO 2100
2000 REM " --- Dist Code
2010 LET O9=1
2020 LET V0$="S",V1$="KR",V2$=B0$(18,2),V0=2,V1=15,V2=7,I0=0
2030 GOSUB 7000
2040 LET B0$(18,2)=V$
2050 FIND (ARM10_DEV,KEY=N0$+"D"+B0$(18,2),DOM=2000)IOL=ARM10D
2060 PRINT @(V1+3,V2),X0$(6,20),
2090 GOTO 3900
2100 REM " --- Terms
2105 GOSUB 6600
2110 LET I0=0
2120 LET V0$="S",V1$="KCR",V2$=B0$(20,2),V0=2,V1=15,V2=8,O9=1,V4$="Enter A Valid Terms Code (<F3>=Lookup)"
2130 GOSUB 7000
2131 IF V3<>3 THEN GOTO 2135
2132 LET V4=1,V5=ARM10_DEV,V6=4,V7=2,V8=6,V9=20,V5$="A"
2133 CALL "SYC.LZ",V1,V2,V4,V5,V6,V7,V8,V9,V$,V5$,N0$
2134 IF V$="" THEN GOTO 2100
2135 IF V3=2 THEN GOTO 1000
2140 LET B0$(20,2)=V$
2150 FIND (ARM10_DEV,KEY=N0$+"A"+B0$(20,2),DOM=2100)IOL=ARM10A
2160 PRINT @(V1+3,V2),X0$(6,20),
2190 GOTO 3900
2200 REM " --- Inv Date
2220 LET V0$="D",V1$="R",V2$=B0$(22,3),V0=8,V1=15,V2=9
2240 GOSUB 7000
2250 LET B0$(22,3)=V$
2260 GOSUB 6200
2290 GOTO 3900
2300 REM " --- Due Date
2320 LET V0$="D",V1$="R",V2$=B0$(25,3),V0=8,V1=15,V2=10
2340 GOSUB 7000
2360 LET B0$(25,3)=V$
2390 GOTO 3900
2400 REM " --- Discount Date
2420 LET V0$="D",V1$="R",V2$=B0$(28,3),V0=8,V1=15,V2=11
2440 GOSUB 7000
2460 LET B0$(28,3)=V$
2490 GOTO 3900
2500 REM " --- Type
2520 LET V0$="S",V1$="R",V2$=B0$(31,1),V3$="SRIM",V4$="S=Regular  R=Return  I=Interest  M=Memo",V0=1,V1=15,V2=12
2540 GOSUB 7000
2560 LET B0$(31,1)=V$
2590 GOTO 3900
2600 REM " --- Amt
2620 LET V0$="N",V2$=STR(B[0]),V3$=M1$,V1=15,V2=13
2640 GOSUB 7000
2660 LET B[0]=V
2670 LET B[1]=B[0]*X[0]/100
2680 PRINT @(15,14),B[1]:M1$,
2690 GOTO 3900
2700 REM " --- Discount
2720 LET V0$="N",V2$=STR(B[1]),V3$=M1$,V1=15,V2=14
2740 GOSUB 7000
2760 LET B[1]=V
2790 GOTO 3900
3000 REM " --- Display Open Orders
3002 PRINT @(15,6),'SB',"<Lookup>",'CL','SF',
3005 LET X0=0
3010 DIM X0$(100)
3015 GOSUB 6600
3020 READ (ART01_DEV,KEY=N0$+"  "+B0$(5,6),DOM=3030)
3040 LET K$=KEY(ART01_DEV,END=3400)
3060 IF POS(N0$+"  "+B0$(5,6)=K$)<>1 THEN GOTO 3400
3080 READ (ART01_DEV)IOL=ART01A2
3090 READ (ART01_DEV,KEY=X0$(1,17)+$FF$,DOM=3100)
3100 REM " --- Print
3120 IF L<=L9 THEN GOTO 3160
3130 GOSUB 6800
3140 IF V$="END" THEN GOTO 1015 ELSE IF V$<>"" THEN GOTO 3470
3150 GOSUB 6600
3160 PRINT @(10,L),X1:"##. ",X0$(11,7),"  ",FNB$(X0$(24,3)),
3170 LET X0=X0+1,X1=X1+1,L=L+1,I0$=I0$+X0$(11,7)
3190 GOTO 3040
3400 REM " --- End Display
3420 IF X0<>0 THEN GOTO 3450
3425 DIM MESSAGE$[1]
3430 LET MESSAGE$[0]="There Are No Open Invoices For This Customer (<Enter>=Continue)"
3435 CALL "SYC.XA",3,MESSAGE$[ALL],0,22,-1,V$,V3
3440 GOTO 1000
3450 GOSUB 6800
3460 IF V$="" THEN GOTO 1015
3475 PRINT 'CF',@(15,6),V$,'CL',
3490 GOTO 1100
3900 REM " --- Next Field
3910 IF V3<>2 THEN GOTO 3940
3920 IF I0>0 THEN LET I0=I0-1
3930 GOTO 3950
3940 LET I0=I0+1
3960 ON I0 GOTO 2100,2200,2300,2400,3990
4000 REM " --- Options
4010 LET V0$="S",V1$="KC",V2$="",V3$="",V4$="Is The Above Information Correct (Y/N/Delete)?",V0=6,V1=FNV(V4$),V2=22
4020 GOSUB 7000
4030 IF V$="DELETE" THEN GOTO 4200
4040 IF V$="" THEN IF O9=0 THEN GOTO 1000
4050 ON POS(V$="YN") GOTO 4000,4100,2100
4100 REM " --- Write
4120 WRITE (ARE06_DEV,KEY=B0$(1,17))IOL=ARE06A
4190 GOTO 1000
4200 REM " --- Delete
4220 REMOVE (ARE06_DEV,KEY=B0$(1,17),DOM=4230)
4290 GOTO 1000
5000 REM " --- Display
5020 PRINT @(15,8),B0$(20,2),@(15,9),FNB$(B0$(22,3)),@(15,10),FNB$(B0$(25,3)),@(15,11),FNB$(B0$(28,3)),
5090 RETURN 
6200 REM " --- Create Due & Disc
6220 LET V=X[1]
6230 CALL "SYC.CD",X0$(26,1),B0$(22,3),V,V$,STATUS
6240 LET B0$(25,3)=V$,V=X[2]
6260 CALL "SYC.CD",X0$(26,1),B0$(22,3),V,V$,STATUS
6270 LET B0$(28,3)=V$
6280 PRINT @(15,10),FNB$(B0$(25,3)),@(15,11),FNB$(B0$(28,3)),
6290 RETURN 
6600 REM " --- Clear Lower Screen
6620 FOR X=23 TO L0 STEP -1
6640 PRINT @(0,X),'CL',
6660 NEXT X
6680 LET L=L0,X1=1,I0$="",V$=""
6690 RETURN 
6800 REM " --- Continue
6810 LET V4$="Enter A Number (1-"+STR(X1-1)+"/<Enter>=Continue)"
6820 LET V0$="S",V1$="C",V2$="",V3$="",V0=1,V1=FNV(V4$),V2=22
6830 GOSUB 7000
6835 IF V3=4 THEN LET V$="END"
6840 IF V$="END" THEN RETURN 
6850 IF V$="" THEN GOTO 6890
6860 LET I=INT(NUM(V$,ERR=6800))
6870 IF I<1 OR I>X1-1 THEN GOTO 6800
6880 LET V$=I0$(7*(I-1)+1,7)
6890 LET I0$=""
6895 RETURN 
7000 REM " --- Standard Input Routine (15May95)"
7010 CALL "SYC.IA",V0$,V1$,V2$,V3$,V4$,PGM(-2),V0,V1,V2,V$,V,V3,DISPLAY_LEN
7020 IF V3=999 THEN GOTO 7200
7030 IF V3=127 THEN GOTO 7100
7090 RETURN 
7100 REM " --- Escape During Input"
7110 CALL "SYC.ES",ERR=7200,PGM(-2),TCB(8),E$,E2,V3
7120 IF V3<>127 THEN GOTO 7000
7130 PRINT @(0,E2),'CL','CURSOR'("ON"),E$,'LF'
7200 REM " --- Error During Input"
7210 ESCAPE
7290 GOTO 7000
8000 REM " --- Functions
8010 DEF FNA$(Q$,Q2$)=STR(MOD((ASC(Q$)-32)*POS(" "<>Q2$(2,1)),100):"00")
8020 DEF FNB$(Q1$)=FNA$(Q1$(2),Q1$)+"/"+FNA$(Q1$(3),Q1$)+"/"+FNA$(Q1$(1),Q1$)
8095 DEF FNV(Q$)=42+INT(LEN(Q$)/2)
8145 REM " --- FNYY21_YY$ Un-Convert 21st Century 2-Char Year to 2-Char Year"
8150 DEF FNYY21_YY$(Q1$)
8155 LET Q3$=" 01234567890123456789",Q1$(1,1)=Q3$(POS(Q1$(1,1)=" 0123456789ABCDEFGHIJ"))
8160 RETURN Q1$
8165 FNEND
9000 REM " --- Standard Error Routine (15May95)"
9010 IF ERR=127 THEN GOTO 9300
9020 CALL "SYC.EA",ERR=9090,EXIT_CTRL,PGM(-2),ERR,TCB(5),E$,E1,E2
9030 IF E1=1 THEN GOTO 9100
9040 IF E1=3 THEN GOTO 9200
9080 PRINT @(0,E2),'CL','CURSOR'("ON"),E$,'LF'
9090 ESCAPE
9100 REM " --- Retry"
9190 RETRY
9200 REM " --- Return"
9290 GOTO 9900
9300 REM " --- Standard Escape Routine"
9310 CALL "SYC.ES",ERR=9350,PGM(-2),TCB(8),E$,E2,V3
9320 IF V3<>127 THEN GOTO 9390
9330 PRINT @(0,E2),'CL','CURSOR'("ON"),E$,'LF'
9350 ESCAPE
9390 RETURN 
9900 RUN "SYS.AA"
9999 END
