0010 REM "SYC - PF Reports Display (List Processing)"
0020 REM "Program SYC.QY"
0022 REM "+-----------------------------------------------------------+"
0024 REM "| ADD+ON Software, Inc. Advantage/V Version 6.0.0 - 15May96 |"
0026 REM "|      Copyright (c) 1996 Open Systems Holdings Corp.       |"
0028 REM "|                  All Rights Reserved                      |"
0030 REM "+-----------------------------------------------------------+"
0031 REM "23Mar98 KJS: Can't copy a PF file in DOS/Windows (220,4130-4170,8500-8590)"
0040 REM 
0045 REM "D_STATUS   : SpeedSearch Status (0=No Error)"
0050 REM "OPTION$[n] : Standard SpeedSearch Options Array"
0055 REM "REPORTS$[n]: Reports to process"
0060 REM "INFO$[n]   : String parameters (see SYC.QR)"
0065 REM "INFO[n]    : Numeric parameters (see SYC.QR)"
0070 REM "SIZES[n]   : Report sizes in bytes"
0075 REM 
0080 SETERR 9000
0085 SETESC 9000
0090 ENTER D_STATUS,OPTION$[ALL],REPORTS$[ALL],INFO$[ALL],INFO[ALL],SIZES[ALL]
0200 REM " --- IOLIST's"
0210 PFXXXA: IOLIST A0$(1),A1$(1)
0220 SYS01S: IOLIST S0$,S1$,S2$,OS$,*,SHELL$
0500 REM " --- Initializations"
0510 DIM A0$(2),A1$(64)
0550 LET PFNAME$=INFO$[1],PICKS$=INFO$[6],CHOICE$=INFO$[0],PAGES=INFO[11]
0560 LET MAXROW=INFO[12],PRINTER=INFO[13],PFILE_DEV=INFO[14]
0570 LET SYS01_DEV=INFO[16],REPORTS=INFO[0],SUBTASK$=FNP$(OPTION$[1])
1000 REM " --- Process next report in REPORTS$"
1010 FOR REPORT=1 TO REPORTS
1020 IF REPORTS$[REPORT]<>"Y" THEN GOTO 3900
1030 LET K$=STR(REPORT:"00"),FILENAME$=PFNAME$+STR(REPORT)
1040 READ (PFILE_DEV,KEY=K$,DOM=3900)IOL=PFXXXA
1050 LET REPORTNAME$=FNP$(A1$(1,40)),BYTES=SIZES[REPORT]
1060 IF CHOICE$="D" THEN GOTO 3500
1090 IF BYTES>0 THEN GOTO 3000
2000 REM " --- File is empty"
2010 DIM MESSAGE$[1]
2020 LET MESSAGE$[0]="This Report Is Empty! (<Enter>=Continue)"
2040 CALL "SYC.XA",2,MESSAGE$[ALL],0,-1,-1,V$,V3
2090 GOTO 3900
3000 REM " --- Call selected subroutine"
3010 LET INFO$[7]=FILENAME$,INFO$[8]=REPORTNAME$
3020 LET INFO[9]=REPORT,INFO[10]=BYTES
3030 CALL SUBTASK$,D_STATUS,OPTION$[ALL],INFO$[ALL],INFO[ALL]
3090 GOTO 3900
3500 REM " --- Delete report"
3510 GOSUB 6000
3900 REM " --- Next report"
3990 NEXT REPORT
4000 REM " --- All selected reports processed"
4010 CLOSE (PRINTER,ERR=4020)
4020 IF CHOICE$="D" THEN GOTO 9900
4090 IF CHOICE$<>"F" THEN GOTO 4900
4100 REM " --- Build command for moving PF file"
4120 FIND (SYS01_DEV,KEY="S",DOM=4130)IOL=SYS01S
4130 IF OS$="D" THEN LET COMMAND$=SHELL$+" /C COPY",SLASH$="\",WRONG_SLASH$="/" ELSE LET COMMAND$="cp",SLASH$="/",WRONG_SLASH$="\"
4140 CALL "SYC.UA",INFO$[9],PATHNAME$
4145 IF OS$="D" THEN LET PATHNAME$=FNSLASH$(PATHNAME$)
4150 LET COMMAND$=COMMAND$+" "+PATHNAME$+" ",DEST$=FNSLASH$(INFO$[10])
4160 IF OS$="U" AND POS("/"=DEST$)=0 THEN LET DEST$="$HOME"+"/"+DEST$
4170 LET COMMAND$=COMMAND$+DEST$
4200 REM " --- Move PF file to home directory"
4205 PRINT @(0,1),
4210 CALL "SYC.OS",COMMAND$
4220 CALL "SYC.WD",INFO$[5]
4230 CALL "SYC.WB",INFO$[2],0
4240 ERASE INFO$[9],ERR=4900
4900 REM " --- Delete this report?"
4910 IF PICKS$<>"N" THEN GOTO 9900
4920 LET V4$="OK To Delete "+$22$+REPORTNAME$+$22$
4930 CALL "SYC.YN",0,V4$,3,V$,V3
4940 IF V$="Y" THEN GOSUB 6000
4990 GOTO 9900
6000 REM " --- Delete a report"
6010 CALL "SYC.WB",INFO$[2],0
6020 PRINT @(0,INFO[2]-4),'CL'," Deleting ",$22$,REPORTNAME$,$22$,
6030 ERASE FILENAME$,ERR=6040
6040 REMOVE (PFILE_DEV,KEY=K$,DOM=6050)
6050 PRINT @(0,INFO[2]-4),'CL',
6090 RETURN 
8000 REM " --- Functions"
8025 DEF FNC(Q$,Q)=INT((Q-LEN(Q$))/2)
8090 DEF FNP$(Q$)=CVS(Q$,2)
8500 REM " --- Convert to correct slash for OS"
8510 DEF FNSLASH$(Q$)
8520 WHILE POS(WRONG_SLASH$=Q$)
8530 LET Q$(POS(WRONG_SLASH$=Q$),1)=SLASH$
8540 WEND
8580 RETURN Q$
8590 FNEND
9000 REM " --- Standard Error Routine (15May95)"
9010 IF ERR=127 THEN GOTO 9300
9020 CALL "SYC.EA",ERR=9090,EXIT_CTRL,PGM(-2),ERR,TCB(5),E$,E1,E2
9030 IF E1=1 THEN GOTO 9100
9040 IF E1=3 THEN GOTO 9200
9080 PRINT @(0,E2),'CL','CURSOR'("ON"),E$,'LF'
9090 ESCAPE
9100 REM " --- Retry"
9190 RETRY
9200 REM " --- Return"
9290 GOTO 9900
9300 REM " --- Standard Escape Routine"
9310 CALL "SYC.ES",ERR=9350,PGM(-2),TCB(8),E$,E2,V3
9320 IF V3<>127 THEN GOTO 9390
9330 PRINT @(0,E2),'CL','CURSOR'("ON"),E$,'LF'
9350 ESCAPE
9390 RETURN 
9900 REM " --- Return to calling program"
9950 EXIT 
9999 END
