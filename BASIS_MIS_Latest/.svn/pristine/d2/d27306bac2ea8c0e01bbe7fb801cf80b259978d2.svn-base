0010 REM "SAU - Purge Sales Analysis (Purge overlay)
0020 REM "Program SAU.AB
0022 REM "+-----------------------------------------------------------+"
0024 REM "| ADD+ON Software, Inc. Advantage/V Version 6.0.0 - 15May96 |"
0026 REM "|      Copyright (c) 1996 Open Systems Holdings Corp.       |"
0028 REM "|                  All Rights Reserved                      |"
0030 REM "+-----------------------------------------------------------+"
0040 REM 
0085 SETESC 9000
0090 SETERR 9000
0200 REM " --- IOLists
0370 SAM01A: IOLIST X0$,QTY[ALL],COST[ALL],SALES[ALL]
0372 SAM02A: IOLIST X0$,QTY[ALL],COST[ALL],SALES[ALL]
0374 SAM03A: IOLIST X0$,QTY[ALL],COST[ALL],SALES[ALL]
0376 SAM04A: IOLIST X0$,QTY[ALL],COST[ALL],SALES[ALL]
0378 SAM05A: IOLIST X0$,QTY[ALL],COST[ALL],SALES[ALL]
0380 SAM06A: IOLIST X0$,QTY[ALL],COST[ALL],SALES[ALL]
0382 SAM07A: IOLIST X0$,QTY[ALL],COST[ALL],SALES[ALL]
0384 SAM08A: IOLIST X0$,QTY[ALL],COST[ALL],SALES[ALL]
0386 SAM09A: IOLIST X0$,QTY[ALL],COST[ALL],SALES[ALL]
0388 SAM10A: IOLIST X0$,QTY[ALL],COST[ALL],SALES[ALL]
0390 SAM11A: IOLIST X0$,QTY[ALL],COST[ALL],SALES[ALL]
0395 SAM21A: IOLIST X0$
0500 REM " --- Initializations
0510 PRECISION IVPRECISION
0520 DIM A[10],W1$(64),W[14]
0530 IF POS("Y"=OPTIONS$,1,0)=1 THEN LET USESEGS=1; REM "There's segment detail
0540 LET MAXFILES=11
0700 REM " --- Background
0750 CALL "SYC.NB","File"+FILL(20)+"  Purging",11,COLUMN
0940 REM " --- Disallow 'M'enu option in Error Routine
0950 LET EXIT_CTRL=1
1000 REM " --- Loop through SA files
1020 FOR OPTPOS=1 TO MAXFILES
1030 IF OPTIONS$(OPTPOS,1)<>"Y" THEN GOTO NEXTOPTPOS
1040 ON OPTPOS GOTO NEXTOPTPOS,CUSTOMER,TERR,SALESREP,CUSTTYPE,SHIPTO,SIC,PRODTYPE,WHSE,VENDOR,DISTCODE,NONSTOCK
1200 REM " --- Customer
1205 CUSTOMER: 
1210 PRINT @(COLUMN-29,11),"Customer"+FILL(9),
1215 DIM X0$(33)
1220 LET X0$(1)=N0$+PURGEYEAR$,SA_DEV=SAM01_DEV
1230 IF USESEGS<>1 THEN GOTO 1270; REM "Purge all in this file for year
1240 LET SEGS=3
1250 DIM SEG_END[SEGS]
1260 LET SEG_END[1]=10,SEG_END[2]=13,SEG_END[3]=LEN(X0$)
1270 GOSUB PURGELOOP
1280 IF USESEGS THEN LET OPTPOS=MAXFILES; REM "Only purging this file
1290 GOTO NEXTOPTPOS
1600 REM " --- Territory
1605 TERR: 
1610 PRINT @(COLUMN-29,11),"Territory"+FILL(8),
1615 DIM X0$(30)
1620 LET X0$(1)=N0$+PURGEYEAR$,SA_DEV=SAM02_DEV
1630 IF USESEGS<>1 THEN GOTO 1670; REM "Purge all in this file for year
1640 LET SEGS=3
1650 DIM SEG_END[SEGS]
1660 LET SEG_END[1]=7,SEG_END[2]=10,SEG_END[3]=LEN(X0$)
1670 GOSUB PURGELOOP
1680 IF USESEGS THEN LET OPTPOS=MAXFILES; REM "Only purging this file
1690 GOTO NEXTOPTPOS
1800 REM " --- Salesperson
1805 SALESREP: 
1810 PRINT @(COLUMN-29,11),"Salesperson"+FILL(6),
1815 DIM X0$(30)
1820 LET X0$(1)=N0$+PURGEYEAR$,SA_DEV=SAM03_DEV
1830 IF USESEGS<>1 THEN GOTO 1870; REM "Purge all in this file for year
1840 LET SEGS=3
1850 DIM SEG_END[SEGS]
1860 LET SEG_END[1]=7,SEG_END[2]=10,SEG_END[3]=LEN(X0$)
1870 GOSUB PURGELOOP
1880 IF USESEGS THEN LET OPTPOS=MAXFILES; REM "Only purging this file
1890 GOTO NEXTOPTPOS
2000 REM " --- Customer Type
2005 CUSTTYPE: 
2010 PRINT @(COLUMN-29,11),"Customer Type"+FILL(4),
2015 DIM X0$(30)
2020 LET X0$(1)=N0$+PURGEYEAR$,SA_DEV=SAM04_DEV
2030 IF USESEGS<>1 THEN GOTO 2070; REM "Purge all in this file for year
2040 LET SEGS=3
2050 DIM SEG_END[SEGS]
2060 LET SEG_END[1]=7,SEG_END[2]=10,SEG_END[3]=LEN(X0$)
2070 GOSUB PURGELOOP
2080 IF USESEGS THEN LET OPTPOS=MAXFILES; REM "Only purging this file
2090 GOTO NEXTOPTPOS
2200 REM " --- Ship-To
2205 SHIPTO: 
2210 PRINT @(COLUMN-29,11),"Ship-to"+FILL(10),
2215 DIM X0$(36)
2220 LET X0$(1)=N0$+PURGEYEAR$,SA_DEV=SAM05_DEV
2230 IF USESEGS<>1 THEN GOTO 2270; REM "Purge all in this file for year
2240 LET SEGS=3
2250 DIM SEG_END[SEGS]
2260 LET SEG_END[1]=10,SEG_END[2]=16,SEG_END[3]=LEN(X0$)
2270 GOSUB PURGELOOP
2280 IF USESEGS THEN LET OPTPOS=MAXFILES; REM "Only purging this file
2290 GOTO NEXTOPTPOS
2400 REM " --- Standard Industry Code
2405 SIC: 
2410 PRINT @(COLUMN-29,11),"SIC"+FILL(14),
2415 DIM X0$(35)
2420 LET X0$(1)=N0$+PURGEYEAR$,SA_DEV=SAM06_DEV
2430 IF USESEGS<>1 THEN GOTO 2470; REM "Purge all in this file for year
2440 LET SEGS=3
2450 DIM SEG_END[SEGS]
2460 LET SEG_END[1]=8,SEG_END[2]=11,SEG_END[3]=LEN(X0$)
2470 GOSUB PURGELOOP
2480 IF USESEGS THEN LET OPTPOS=MAXFILES; REM "Only purging this file
2490 GOTO NEXTOPTPOS
2600 REM " --- Product Type
2605 PRODTYPE: 
2610 PRINT @(COLUMN-29,11),"Product Type"+FILL(5),
2615 DIM X0$(27)
2620 LET X0$(1)=N0$+PURGEYEAR$,SA_DEV=SAM07_DEV
2630 IF USESEGS<>1 THEN GOTO 2670; REM "Purge all in this file for year
2640 LET SEGS=3
2650 DIM SEG_END[SEGS]
2660 LET SEG_END[1]=7,SEG_END[2]=LEN(X0$)
2670 GOSUB PURGELOOP
2680 IF USESEGS THEN LET OPTPOS=MAXFILES; REM "Only purging this file
2690 GOTO NEXTOPTPOS
2800 REM " --- Warehouse
2805 WHSE: 
2810 PRINT @(COLUMN-29,11),"Warehouse"+FILL(8),
2815 DIM X0$(29)
2820 LET X0$(1)=N0$+PURGEYEAR$,SA_DEV=SAM08_DEV
2830 IF USESEGS<>1 THEN GOTO 2870; REM "Purge all in this file for year
2840 LET SEGS=3
2850 DIM SEG_END[SEGS]
2860 LET SEG_END[1]=6,SEG_END[2]=9,SEG_END[3]=LEN(X0$)
2870 GOSUB PURGELOOP
2880 IF USESEGS THEN LET OPTPOS=MAXFILES; REM "Only purging this file
2890 GOTO NEXTOPTPOS
3000 REM " --- Stocking Vendor
3005 VENDOR: 
3010 PRINT @(COLUMN-29,11),"Stocking Vendor"+FILL(2),
3015 DIM X0$(33)
3020 LET X0$(1)=N0$+PURGEYEAR$,SA_DEV=SAM09_DEV
3030 IF USESEGS<>1 THEN GOTO 3070; REM "Purge all in this file for year
3040 LET SEGS=3
3050 DIM SEG_END[SEGS]
3060 LET SEG_END[1]=10,SEG_END[2]=13,SEG_END[3]=LEN(X0$)
3070 GOSUB PURGELOOP
3080 IF USESEGS THEN LET OPTPOS=MAXFILES; REM "Only purging this file
3090 GOTO NEXTOPTPOS
3200 REM " --- Distribution Code
3205 DISTCODE: 
3210 PRINT @(COLUMN-29,11),"Distribution Code",
3215 DIM X0$(29)
3220 LET X0$(1)=N0$+PURGEYEAR$,SA_DEV=SAM10_DEV
3230 IF USESEGS<>1 THEN GOTO 3270; REM "Purge all in this file for year
3240 LET SEGS=3
3250 DIM SEG_END[SEGS]
3260 LET SEG_END[1]=6,SEG_END[2]=9,SEG_END[3]=LEN(X0$)
3270 GOSUB PURGELOOP
3280 IF USESEGS THEN LET OPTPOS=MAXFILES; REM "Only purging this file
3290 GOTO NEXTOPTPOS
3400 REM " --- Non-stock
3405 NONSTOCK: 
3410 PRINT @(COLUMN-29,11),"Non-stock"+FILL(8),
3415 DIM X0$(47)
3420 LET X0$(1)=N0$+PURGEYEAR$,SA_DEV=SAM11_DEV
3430 IF USESEGS<>1 THEN GOTO 3470; REM "Purge all in this file for year
3440 LET SEGS=2
3450 DIM SEG_END[SEGS]
3460 LET SEG_END[1]=7,SEG_END[2]=LEN(X0$)
3470 GOSUB PURGELOOP
3480 IF USESEGS THEN LET OPTPOS=MAXFILES; REM "Only purging this file
3490 GOTO NEXTOPTPOS
3700 REM " --- Loop back for next option position
3705 NEXTOPTPOS: 
3720 NEXT OPTPOS
4000 REM " --- All done
4090 GOTO 9900
6000 REM " --- Purge Loop
6005 PURGELOOP: 
6020 IF USESEGS<>1 THEN GOTO 6100
6030 IF SEGMENTS=3 THEN LET X0$(5)=FIELDS$[1]+FIELDS$[2]+FIELDS$[3]
6040 IF SEGMENTS=2 THEN LET X0$(5)=FIELDS$[1]+FIELDS$[2]
6050 IF SEGMENTS=1 THEN LET X0$(5)=FIELDS$[1]
6100 REM " --- Purge Loop
6110 DIM QTY[12],COST[12],SALES[12]
6130 READ (SA_DEV,KEY=X0$,DOM=READSA,END=6660)IOL=SAM01A
6140 LET KSA$=KEYP(SA_DEV)
6150 GOTO TESTIT
6160 READSA: 
6180 LET KSA$=KEY(SA_DEV,END=6660)
6190 READ (SA_DEV)IOL=SAM01A
6200 REM " --- Test for validity
6205 TESTIT: 
6210 IF KSA$(1,4)<>N0$+PURGEYEAR$ THEN GOTO 6660
6220 IF USESEGS<>1 THEN GOTO ZERO
6230 IF SEGMENTS<3 THEN GOTO TEST2
6240 IF FIELDS$[3]="" THEN GOTO TEST2
6250 IF KSA$(SEG_END[2]+1,SEG_END[3]-SEG_END[2])=FIELDS$[3] THEN GOTO ZERO
6260 READ (SA_DEV,KEY=KSA$(1,SEG_END[2])+$FF$,DOM=6270)
6270 GOTO NEXTSAM
6280 TEST2: 
6290 IF SEGMENTS<2 THEN GOTO TEST1
6300 IF FIELDS$[2]="" THEN GOTO TEST1
6310 IF KSA$(SEG_END[1]+1,SEG_END[2]-SEG_END[1])=FIELDS$[2] THEN GOTO ZERO
6320 READ (SA_DEV,KEY=KSA$(1,SEG_END[1])+$FF$,DOM=6330)
6330 GOTO NEXTSAM
6340 TEST1: 
6350 IF SEGMENTS<1 THEN GOTO ZERO
6360 IF KSA$(5,SEG_END[1]-4)=FIELDS$[1] THEN GOTO ZERO
6380 GOTO 6660
6500 REM " --- Zero balance?
6510 ZERO: 
6520 IF PURGERECS$<>"Z" THEN GOTO REMOVESA
6530 FOR CNT=0 TO 12
6540 IF QTY[CNT]<>0 AND SALES[CNT]<>0 THEN EXITTO NEXTSAM
6550 NEXT CNT
6560 REMOVESA: 
6570 PRINT @(COLUMN,11),KSA$(1,4)," ",KSA$(5,6),
6580 REMOVE (SA_DEV,KEY=KSA$)
6600 REM " --- If purging SAM-01, purge SAM-21
6610 IF OPTPOS<>1 THEN GOTO NEXTSAM
6620 LET K21$=KSA$(1,4)+KSA$(11,23)+KSA$(5,6)
6630 REMOVE (SAM21_DEV,KEY=K21$,DOM=NEXTSAM)
6640 NEXTSAM: 
6650 GOTO READSA
6660 RETURN 
8000 REM " --- Functions
8095 DEF FNP$(Q$)=CVS(Q$,2)
8200 REM " --- FNF$ AlphaNumeric Masking Function"
8210 DEF FNF$(Q1$,Q2$)
8220 IF Q2$="" THEN LET Q2$=FILL(LEN(Q1$),"0")
8230 RETURN STR(-NUM(Q1$,ERR=ALPHA_FNF):Q2$,ERR=ALPHA_FNF)
8240 ALPHA_FNF: 
8245 LET Q=1,Q0=0
8250 WHILE LEN(Q2$(Q))
8255 IF POS(Q2$(Q,1)="-()") THEN LET Q0=Q0+1 ELSE LET Q2$(Q,1)="X"
8260 LET Q=Q+1
8265 WEND
8270 IF LEN(Q1$)>LEN(Q2$)-Q0 THEN LET Q1$=Q1$(1,LEN(Q2$)-Q0)
8280 RETURN STR(Q1$:Q2$)
8290 FNEND
9000 REM " --- Standard Error Routine (15May95)"
9010 IF ERR=127 THEN GOTO 9300
9020 CALL "SYC.EA",ERR=9090,EXIT_CTRL,PGM(-2),ERR,TCB(5),E$,E1,E2
9030 IF E1=1 THEN GOTO 9100
9040 IF E1=3 THEN GOTO 9200
9080 PRINT @(0,E2),'CL','CURSOR'("ON"),E$,'LF'
9090 ESCAPE
9100 REM " --- Retry"
9190 RETRY
9200 REM " --- Return"
9210 SETERR 9000
9290 GOTO 9900
9300 REM " --- Standard Escape Routine"
9310 CALL "SYC.ES",ERR=9350,PGM(-2),TCB(8),E$,E2,V3
9320 IF V3<>127 THEN GOTO 9390
9330 PRINT @(0,E2),'CL','CURSOR'("ON"),E$,'LF'
9350 ESCAPE
9390 RETURN 
9900 RUN "SYS.AA"
9999 END
